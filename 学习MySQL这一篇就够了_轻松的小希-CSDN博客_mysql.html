<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-b5506197d8.css">
                <div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p>
<div class="toc">
 <h3><a name="t0"></a><a name="t0"></a>目录</h3>
 <ul><li><ul><li><a href="#__7" target="_self">第一章 数据库概述</a></li><li><ul><li><a href="#11_9" target="_self">1.1、数据库的好处</a></li><li><a href="#12_14" target="_self">1.2、数据库的常见概念</a></li><li><a href="#13_21" target="_self">1.3、数据库的存储特点</a></li><li><a href="#14_28" target="_self">1.4、数据库的常见分类</a></li><li><a href="#15SQL_37" target="_self">1.5、SQL语言的分类</a></li></ul>
   </li><li><a href="#_MySQL_45" target="_self">第二章 MySQL概述</a></li><li><ul><li><a href="#21MySQL_47" target="_self">2.1、MySQL的背景</a></li><li><a href="#22MySQL_51" target="_self">2.2、MySQL的优点</a></li><li><a href="#23MySQL_57" target="_self">2.3、MySQL的安装</a></li><li><a href="#24MySQL_111" target="_self">2.4、MySQL的启动</a></li><li><a href="#25MySQL_117" target="_self">2.5、MySQL的停止</a></li><li><a href="#26MySQL_123" target="_self">2.6、MySQL的登录</a></li><li><a href="#27MySQL_129" target="_self">2.7、MySQL的退出</a></li></ul>
   </li><li><a href="#_DQL_135" target="_self">第三章 DQL语言</a></li><li><ul><li><a href="#31_137" target="_self">3.1、基础查询</a></li><li><a href="#32_228" target="_self">3.2、条件查询</a></li><li><a href="#33_431" target="_self">3.3、排序查询</a></li><li><a href="#34_505" target="_self">3.4、单行函数</a></li><li><a href="#35_884" target="_self">3.5、分组函数</a></li><li><a href="#36_948" target="_self">3.6、分组查询</a></li><li><a href="#37_1053" target="_self">3.7、连接查询</a></li><li><a href="#38sql99_1130" target="_self">3.8、sql99标准</a></li><li><a href="#39_1233" target="_self">3.9、子查询</a></li><li><a href="#310_1391" target="_self">3.10、分页查询</a></li><li><a href="#311_1422" target="_self">3.11、联合查询</a></li></ul>
   </li><li><a href="#_DML_1451" target="_self">第四章 DML语言</a></li><li><ul><li><a href="#41_1453" target="_self">4.1、插入语句</a></li><li><a href="#42_1496" target="_self">4.2、修改语句</a></li><li><a href="#43_1555" target="_self">4.3、删除语句</a></li></ul>
   </li><li><a href="#_DDL_1617" target="_self">第五章 DDL语言</a></li><li><ul><li><a href="#51_1619" target="_self">5.1、库的管理</a></li><li><ul><li><a href="#511_1621" target="_self">5.1.1、库的创建</a></li><li><a href="#512_1627" target="_self">5.1.2、库的修改</a></li><li><a href="#513_1637" target="_self">5.1.3、库的删除</a></li></ul>
    </li><li><a href="#52_1643" target="_self">5.2、表的管理</a></li><li><ul><li><a href="#521_1645" target="_self">5.2.1、表的创建</a></li><li><a href="#522_1656" target="_self">5.2.2、表的修改</a></li><li><a href="#523_1675" target="_self">5.2.3、表的删除</a></li><li><a href="#524_1683" target="_self">5.2.4、表的复制</a></li></ul>
    </li><li><a href="#53_1702" target="_self">5.3、数据类型</a></li><li><ul><li><a href="#531_1704" target="_self">5.3.1、数值型</a></li><li><a href="#532_1719" target="_self">5.3.2、浮点型</a></li><li><a href="#533_1737" target="_self">5.3.3、字符型</a></li><li><a href="#534_1751" target="_self">5.3.4、日期型</a></li></ul>
    </li><li><a href="#54_1766" target="_self">5.4、常见约束</a></li><li><a href="#55_1870" target="_self">5.5、自增长列</a></li></ul>
   </li><li><a href="#_DCL_1903" target="_self">第六章 DCL语言</a></li><li><ul><li><a href="#61_1909" target="_self">6.1、创建用户</a></li><li><a href="#62_1916" target="_self">6.2、删除用户</a></li><li><a href="#63_1923" target="_self">6.3、用户授权</a></li><li><a href="#64_1930" target="_self">6.4、撤销授权</a></li><li><a href="#65_1937" target="_self">6.5、刷新授权</a></li><li><a href="#66_1943" target="_self">6.6、查看授权</a></li><li><a href="#67_1950" target="_self">6.7、修改密码</a></li><li><a href="#68_1961" target="_self">6.8、忘记密码</a></li></ul>
   </li><li><a href="#_TCL_1971" target="_self">第七章 TCL语言</a></li><li><ul><li><a href="#71_1973" target="_self">7.1、事务</a></li><li><a href="#72_2008" target="_self">7.2、事务并发（读问题）</a></li><li><a href="#73_2045" target="_self">7.3、丢失更新（写问题）</a></li></ul>
   </li><li><a href="#__2062" target="_self">第八章 高级部分</a></li><li><ul><li><a href="#81_2064" target="_self">8.1、索引</a></li><li><a href="#82_2132" target="_self">8.2、视图</a></li><li><a href="#83_2193" target="_self">8.3、存储过程</a></li><li><ul><li><a href="#831_2195" target="_self">8.3.1、语法</a></li><li><a href="#832_2247" target="_self">8.3.2、变量</a></li><li><a href="#833_2342" target="_self">8.3.3、分支结构</a></li><li><ul><li><a href="#8331if_2344" target="_self">8.3.3.1、if结构</a></li><li><a href="#8332case_2380" target="_self">8.3.3.2、case结构</a></li></ul>
     </li><li><a href="#834_2428" target="_self">8.3.4、循环结构</a></li><li><ul><li><a href="#8341while_2436" target="_self">8.3.4.1、while结构</a></li><li><a href="#8342repeat_2462" target="_self">8.3.4.2、repeat结构</a></li><li><a href="#8343loop_2486" target="_self">8.3.4.3、loop结构</a></li></ul>
     </li><li><a href="#835_2512" target="_self">8.3.5、游标</a></li></ul>
    </li><li><a href="#84_2599" target="_self">8.4、函数</a></li><li><a href="#85_2648" target="_self">8.5、触发器</a></li><li><a href="#86_2779" target="_self">8.6、事件</a></li></ul>
   </li><li><a href="#__2881" target="_self">第九章 数据备份与恢复</a></li><li><ul><li><a href="#91_2883" target="_self">9.1、数据导出</a></li><li><a href="#92_2899" target="_self">9.2、数据导入</a></li></ul>
   </li><li><a href="#_MySQL_2919" target="_self">第十章 安装MySQL单实例</a></li><li><ul><li><a href="#101_2921" target="_self">10.1、准备虚拟机</a></li><li><a href="#102_2935" target="_self">10.2、删除自带库</a></li><li><a href="#103_2943" target="_self">10.3、安装依赖包</a></li><li><a href="#104_2949" target="_self">10.4、下载服务端</a></li><li><a href="#105_2964" target="_self">10.5、安装服务端</a></li><li><a href="#106_2970" target="_self">10.6、下载客户端</a></li><li><a href="#107_2985" target="_self">10.7、安装客户端</a></li><li><a href="#108_2991" target="_self">10.8、启动数据库服务</a></li><li><a href="#109_2999" target="_self">10.9、查看初始化密码</a></li><li><a href="#1010_3006" target="_self">10.10、修改初始化密码</a></li><li><a href="#1011_3021" target="_self">10.11、远程的授权</a></li><li><a href="#1012_3044" target="_self">10.12、开放防火墙</a></li><li><a href="#1013_3052" target="_self">10.13、添加自启动</a></li><li><a href="#1014_3059" target="_self">10.14、测试连接</a></li><li><a href="#1015_3063" target="_self">10.15、关闭系统</a></li></ul>
   </li><li><a href="#_MySQL_3074" target="_self">第十一章 安装MySQL主从复制</a></li><li><ul><li><a href="#111_3076" target="_self">11.1、准备虚拟机</a></li><li><a href="#112_3090" target="_self">11.2、主从复制介绍</a></li><li><a href="#113_3094" target="_self">11.3、主从复制架构</a></li><li><a href="#114_3100" target="_self">11.4、主节点配置</a></li><li><a href="#115_3170" target="_self">11.5、从节点配置</a></li><li><a href="#116_3308" target="_self">11.6、连接测试</a></li></ul>
   </li><li><a href="#_MySQL_3361" target="_self">第十二章 安装MySQL读写分离</a></li><li><ul><li><a href="#121_3363" target="_self">12.1、环境准备</a></li><li><a href="#122_3375" target="_self">12.2、读写分离介绍</a></li><li><a href="#123_3379" target="_self">12.3、读写分离架构</a></li><li><a href="#124_3385" target="_self">12.4、修改从节点二</a></li><li><a href="#125proxysql_3460" target="_self">12.5、安装proxysql</a></li><li><a href="#126_3585" target="_self">12.6、删除自带库</a></li><li><a href="#127_3593" target="_self">12.7、安装依赖包</a></li><li><a href="#128_3599" target="_self">12.8、下载服务端</a></li><li><a href="#129_3614" target="_self">12.9、安装服务端</a></li><li><a href="#1210_3620" target="_self">12.10、下载客户端</a></li><li><a href="#1211_3635" target="_self">12.11、安装客户端</a></li><li><a href="#1212_3641" target="_self">12.12、启动数据库服务</a></li><li><a href="#1213_3649" target="_self">12.13、查看初始化密码</a></li><li><a href="#1214_3656" target="_self">12.14、修改初始化密码</a></li><li><a href="#1215_3678" target="_self">12.15、创建两个账号</a></li><li><a href="#1216proxysql_3707" target="_self">12.16、配置proxysql</a></li><li><a href="#1217proxysql_3747" target="_self">12.17、连接proxysql</a></li><li><a href="#1218_3779" target="_self">12.18、查询监控数据</a></li></ul>
   </li><li><a href="#_MySQL_3788" target="_self">第十三章 安装MySQL分片集群</a></li><li><ul><li><a href="#131_3790" target="_self">13.1、环境准备</a></li><li><a href="#132_3796" target="_self">13.2、分片集群介绍</a></li><li><a href="#133_3802" target="_self">13.3、分片集群架构</a></li><li><a href="#134Mycat_3811" target="_self">13.4、Mycat的介绍</a></li><li><a href="#135Mycat_3825" target="_self">13.5、Mycat的分片</a></li><li><a href="#136Mycat_3839" target="_self">13.6、Mycat的安装</a></li><li><a href="#137Mycat_3946" target="_self">13.7、Mycat的配置</a></li><li><a href="#138Mycat_4080" target="_self">13.8、Mycat的启动</a></li><li><a href="#139Mycat_4102" target="_self">13.9、Mycat的测试</a></li><li><a href="#1310Mycat_4166" target="_self">13.10、Mycat的效果</a></li><li><a href="#1311Mycat_4194" target="_self">13.11、Mycat的踩坑</a></li></ul>
  </li></ul>
 </li></ul>
</div>
<p></p> 
<hr> 
<p><strong>配套资料，免费下载</strong><br> 链接：https://pan.baidu.com/s/1WmxBogBdP2yyCSe6YPm6Hg<br> 提取码：y287<br> 复制这段内容后打开百度网盘手机App，操作更方便哦</p> 
<h2><a name="t1"></a><a name="t1"></a><a id="__7"></a>第一章 数据库概述</h2> 
<h3><a name="t2"></a><a name="t2"></a><a id="11_9"></a>1.1、数据库的好处</h3> 
<ol><li>将数据持久化到本地</li><li>提供结构化查询功能</li></ol> 
<h3><a name="t3"></a><a name="t3"></a><a id="12_14"></a>1.2、数据库的常见概念</h3> 
<ol><li>DB：数据库，存储数据的仓库</li><li>DBMS：数据库管理系统，又称为数据库软件或者数据库产品，用于创建和管理数据库，常见的有MySQL、Oracle、SQL Server</li><li>DBS：数据库系统，数据库系统是一个通称，包括数据库、数据库管理系统、数据库管理人员等，是最大的范畴</li><li>SQL：结构化查询语言，用于和数据库通信的语言，不是某个数据库软件特有的，而是几乎所有的主流数据库软件通用的语言</li></ol> 
<h3><a name="t4"></a><a name="t4"></a><a id="13_21"></a>1.3、数据库的存储特点</h3> 
<ol><li>数据存放到表中，然后表再放到库中</li><li>一个库中可以有多张表，每张表具有唯一的表名用来标识自己</li><li>表中有一个或多个列，列又称为“字段”，相当于Java中“属性”</li><li>表中的每一行数据，相当于Java中“对象”</li></ol> 
<h3><a name="t5"></a><a name="t5"></a><a id="14_28"></a>1.4、数据库的常见分类</h3> 
<ol><li>关系型数据库：MySQL、Oracle、DB2、SQL Server</li><li>非关系型数据库： 
  <ul><li>键值存储数据库：Redis、Memcached、MemcacheDB</li><li>列存储数据库：HBase、Cassandra</li><li>面向文档的数据库：MongDB、CouchDB</li><li>图形数据库：Neo4J</li></ul> </li></ol> 
<h3><a name="t6"></a><a name="t6"></a><a id="15SQL_37"></a>1.5、SQL语言的分类</h3> 
<ol><li>DQL：数据查询语言：select、from、where</li><li>DML：数据操作语言：insert、update、delete</li><li>DDL：数据定义语言：create、alter、drop、truncate</li><li>DCL：数据控制语言：grant、revoke</li><li>TCL：事务控制语言：commit、rollback</li></ol> 
<h2><a name="t7"></a><a name="t7"></a><a id="_MySQL_45"></a>第二章 MySQL概述</h2> 
<h3><a name="t8"></a><a name="t8"></a><a id="21MySQL_47"></a>2.1、MySQL的背景</h3> 
<p>MySQL的前身是属于MySQL AB，08年被SUN公司收购，09年SUN公司又被Oracle公司收购</p> 
<h3><a name="t9"></a><a name="t9"></a><a id="22MySQL_51"></a>2.2、MySQL的优点</h3> 
<ol><li>成本低、开源免费</li><li>性能高、移植性好</li><li>体积小、便于安装</li></ol> 
<h3><a name="t10"></a><a name="t10"></a><a id="23MySQL_57"></a>2.3、MySQL的安装</h3> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzMTUucG5n?x-oss-process=image/format,png" alt="01"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzMTkucG5n?x-oss-process=image/format,png" alt="02"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzMjMucG5n?x-oss-process=image/format,png" alt="03"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzMjUucG5n?x-oss-process=image/format,png" alt="04"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzMjgucG5n?x-oss-process=image/format,png" alt="05"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzMzMucG5n?x-oss-process=image/format,png" alt="06"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzNDAucG5n?x-oss-process=image/format,png" alt="07"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzNDMucG5n?x-oss-process=image/format,png" alt="08"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzNDUucG5n?x-oss-process=image/format,png" alt="09"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzNDgucG5n?x-oss-process=image/format,png" alt="10"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzNTEucG5n?x-oss-process=image/format,png" alt="11"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzNTMucG5n?x-oss-process=image/format,png" alt="12"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzNTYucG5n?x-oss-process=image/format,png" alt="13"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQzNTkucG5n?x-oss-process=image/format,png" alt="14"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MDIucG5n?x-oss-process=image/format,png" alt="15"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MDQucG5n?x-oss-process=image/format,png" alt="16"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MDcucG5n?x-oss-process=image/format,png" alt="17"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MDkucG5n?x-oss-process=image/format,png" alt="18"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MTEucG5n?x-oss-process=image/format,png" alt="19"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MTMucG5n?x-oss-process=image/format,png" alt="20"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MTYucG5n?x-oss-process=image/format,png" alt="21"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MTgucG5n?x-oss-process=image/format,png" alt="22"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MjEucG5n?x-oss-process=image/format,png" alt="23"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MjMucG5n?x-oss-process=image/format,png" alt="24"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MjUucG5n?x-oss-process=image/format,png" alt="25"></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjEyMjQ0MjkucG5n?x-oss-process=image/format,png" alt="26"></p> 
<h3><a name="t11"></a><a name="t11"></a><a id="24MySQL_111"></a>2.4、MySQL的启动</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">net start MySQL
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t12"></a><a name="t12"></a><a id="25MySQL_117"></a>2.5、MySQL的停止</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">net stop MySQL
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t13"></a><a name="t13"></a><a id="26MySQL_123"></a>2.6、MySQL的登录</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql -h主机名 -P端口号 -u用户名 -p密码
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t14"></a><a name="t14"></a><a id="27MySQL_129"></a>2.7、MySQL的退出</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">exit</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h2><a name="t15"></a><a name="t15"></a><a id="_DQL_135"></a>第三章 DQL语言</h2> 
<h3><a name="t16"></a><a name="t16"></a><a id="31_137"></a>3.1、基础查询</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 查询列表 <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>二、特点</strong></p> 
<ol><li>查询列表可以是字段、常量、函数、表达式</li><li>查询结果是一个虚拟表</li></ol> 
<p><strong>三、示例</strong></p> 
<p>1、查询单个字段</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 字段名 <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>2、查询多个字段</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 字段名<span class="token punctuation">,</span>字段名 <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>3、查询所有字段</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、查询常量</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 常量值<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>注意：字符型和日期型的常量值必须用单引号引起来，数值型不需要</p> 
<p>5、查询函数</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 函数名<span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>6、查询表达式</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token number">100</span><span class="token operator">/</span><span class="token number">25</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>7、起别名</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、 <span class="token keyword">SELECT</span> 字段名 <span class="token keyword">AS</span> <span class="token string">"别名"</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>注意：别名可以使用单引号、双引号引起来，当只有一个单词时，可以省略引号，当有多个单词且有空格或特殊符号时，不能省略，AS可以省略</p> 
<p>8、去重复</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> 字段名 <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>9、做加法</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、 <span class="token keyword">SELECT</span> 数值<span class="token operator">+</span>数值<span class="token punctuation">;</span> 直接运算
<span class="token number">2</span>、 <span class="token keyword">SELECT</span> 字符<span class="token operator">+</span>数值<span class="token punctuation">;</span> 首先先将字符转换为整数，如果转换成功，则继续运算，如果转换失败，则默认为<span class="token number">0</span>，然后继续运算
<span class="token number">3</span>、 <span class="token keyword">SELECT</span> <span class="token boolean">NULL</span><span class="token operator">+</span>数值<span class="token punctuation">;</span> <span class="token boolean">NULL</span>和任何数值参与运算结果都是<span class="token boolean">NULL</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p>10、【补充】ifnull函数</p> 
<p>功能：判断某字段或表达式是否为null，如果为null，返回指定的值，否则返回原本的值</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span>字段名<span class="token punctuation">,</span> 指定值<span class="token punctuation">)</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>11、【补充】isnull函数</p> 
<p>功能：判断某字段或表达式是否为null，如果是null，则返回1，否则返回0</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> ISNULL<span class="token punctuation">(</span>字段名<span class="token punctuation">)</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t17"></a><a name="t17"></a><a id="32_228"></a>3.2、条件查询</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 查询列表 <span class="token keyword">FROM</span> 表名 <span class="token keyword">WHERE</span> 筛选条件<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>二、分类</strong></p> 
<ol><li>条件运算符：&gt;、&gt;=、&lt;、&lt;=、=、&lt;=&gt;、!=、&lt;&gt;</li><li>逻辑运算符：and、or、not</li><li>模糊运算符： 
  <ul><li>like：%任意多个字符、_任意单个字符，如果有特殊字符，需要使用escape转义</li><li>between and</li><li>not between and</li><li>in</li><li>is null</li><li>is not null</li></ul> </li></ol> 
<p><strong>三、演示</strong></p> 
<p>1、查询工资&gt;12000的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">&gt;</span> <span class="token number">12000</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>2、查询工资&gt;=14000的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">&gt;=</span> <span class="token number">14000</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>3、查询工资&lt;12000的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">&lt;</span> <span class="token number">12000</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>4、查询工资&lt;=14000的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">&lt;=</span> <span class="token number">14000</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>5、查询员工编号=100的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">100</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>6、查询员工编号&lt;=&gt;100的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> employee_id <span class="token operator">&lt;=&gt;</span> <span class="token number">100</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>注意：=只能判断普通类型的数值，而&lt;=&gt;不仅可以判断普通类型的数值还可以判断NULL</p> 
<p>7、查询员工编号!=100的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> employee_id <span class="token operator">!=</span> <span class="token number">100</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>8、查询员工编号&lt;&gt;100的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> employee_id <span class="token operator">&lt;&gt;</span> <span class="token number">100</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>注意：!=和&lt;&gt;都是判断不等于的意思，但是MySQL推荐使用&lt;&gt;</p> 
<p>9、查询工资&gt;12000&amp;&amp;工资&lt;18000的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">&gt;</span> <span class="token number">12000</span> <span class="token operator">AND</span> salary <span class="token operator">&lt;</span> <span class="token number">18000</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>10、查询工资&lt;=12000||工资&gt;=18000的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">&lt;=</span> <span class="token number">12000</span> <span class="token operator">OR</span> salary <span class="token operator">&gt;=</span> <span class="token number">18000</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>11、查询工资&lt;=12000||工资&gt;=18000的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token punctuation">(</span>salary <span class="token operator">&gt;</span> <span class="token number">12000</span> <span class="token operator">AND</span> salary <span class="token operator">&lt;</span> <span class="token number">18000</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>12、查询员工名中第一个字符为B、第四个字符为d的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span>
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> last_name <span class="token operator">LIKE</span> <span class="token string">'B__d%'</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>13、查询员工编号在100到120之间的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> employee_id <span class="token operator">BETWEEN</span> <span class="token number">100</span> <span class="token operator">AND</span> <span class="token number">120</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>14、查询员工编号不在100到120之间的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> employee_id <span class="token operator">NOT</span> <span class="token operator">BETWEEN</span> <span class="token number">100</span> <span class="token operator">AND</span> <span class="token number">120</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>15、查询员工的工种编号是 IT_PROG、AD_VP、AD_PRES中的一个员工名和工种编号</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  job_id 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> job_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'IT_PROT'</span><span class="token punctuation">,</span> <span class="token string">'AD_VP'</span><span class="token punctuation">,</span> <span class="token string">'AD_PRES'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>注意：in列表的值类型必须一致或兼容，in列表中不支持通配符%和_</p> 
<p>16、查询没有奖金的员工名和奖金率</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  commission_pct 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> commission_pct <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>17、查询有奖金的员工名和奖金率</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  commission_pct 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> commission_pct <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>注意：=、!=不能用来判断NULL、而&lt;=&gt;、is null 、 is not null可以用来判断NULL，但注意&lt;=&gt;也可以判断普通类型的数值</p> 
<h3><a name="t18"></a><a name="t18"></a><a id="33_431"></a>3.3、排序查询</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  查询列表 
<span class="token keyword">FROM</span>
  表 
【<span class="token keyword">WHERE</span> 筛选条件】
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 排序列表 【<span class="token keyword">asc</span> <span class="token operator">|</span> <span class="token keyword">desc</span>】 <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p><strong>二、注意</strong></p> 
<ol><li>排序列表可以是单个字段、多个字段、别名、函数、表达式</li><li>asc代表升序，desc代表降序，如果不写，默认是asc</li><li>order by的位置一般放在查询语句的最后（除limit语句之外）</li></ol> 
<p><strong>三、示例</strong></p> 
<p>1、按单个字段排序：查询员工信息，要求按工资降序</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> salary <span class="token keyword">DESC</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>2、按多个字段查询：查询员工信息，要求先按工资降序，再按员工编号升序</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> salary <span class="token keyword">DESC</span><span class="token punctuation">,</span> employee_id <span class="token keyword">ASC</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>3、按别名排序查询：查询员工信息，要求按员工年薪升序</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span><span class="token punctuation">,</span>
  salary <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span> IFNULL<span class="token punctuation">(</span>commission_pct<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 年薪 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 年薪 <span class="token keyword">ASC</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>4、按函数排序查询：查询员工信息，要求按员工名字的长度降序</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  LENGTH<span class="token punctuation">(</span>last_name<span class="token punctuation">)</span><span class="token punctuation">,</span>
  last_name 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> LENGTH<span class="token punctuation">(</span>last_name<span class="token punctuation">)</span> <span class="token keyword">DESC</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>5、按表达式排序：查询员工信息，要求按员工年薪升序</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span><span class="token punctuation">,</span>
  salary <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span> IFNULL<span class="token punctuation">(</span>commission_pct<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> salary <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span> IFNULL<span class="token punctuation">(</span>commission_pct<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ASC</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<h3><a name="t19"></a><a name="t19"></a><a id="34_505"></a>3.4、单行函数</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 函数名<span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span> 【<span class="token keyword">FROM</span> 表】<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>二、分类</strong></p> 
<ol><li> <p>字符函数</p> 
  <ul><li>concat：连接字符</li><li>substr：截取子串</li><li>replace：替换字符</li><li>upper：变大写</li><li>lower：变小写</li><li>lpad：左填充</li><li>rpad：右填充</li><li>length：获取字节长度</li><li>trim：去除前后空格</li><li>instr：获取子串第一次出现的索引</li></ul> <pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、注意MySQL中的索引是从<span class="token number">1</span>开始的
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> </li><li> <p>数学函数</p> 
  <ul><li>round：四舍五入</li><li>ceil：向上取整</li><li>floor：向下取整</li><li>mod：取模运算（a-a/b*b）</li><li>truncate：保留小数的位数，不进行四舍五入</li><li>rand：获取随机数，返回0-1之间的小数</li></ul> </li><li> <p>日期函数</p> 
  <ul><li>now：返回当前日期+时间</li><li>curdate：返回当前日期</li><li>curtime：返回当前时间</li><li>year：返回年</li><li>month：返回月</li><li>day：返回日</li><li>hour：小时</li><li>minute：分钟</li><li>second：秒</li><li>monthname：以英文形式返回月</li><li>datediff：返回两个日期相差的天数</li><li>date_format：将日期转换成字符</li><li>str_to_date：将字符转换成日期</li></ul> <pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">格式符：
<span class="token operator">%</span>Y：四位的年份
<span class="token operator">%</span>y：二位的年份
<span class="token operator">%</span>m：二位的月份（<span class="token number">01</span>，<span class="token number">02</span>，<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>，<span class="token number">12</span>）
<span class="token operator">%</span>c：一位的月份（<span class="token number">1</span>，<span class="token number">2</span>，<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>，<span class="token number">12</span>）
<span class="token operator">%</span>d：日（<span class="token number">01</span>，<span class="token number">02</span>，<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>，<span class="token number">31</span>）
<span class="token operator">%</span>H：小时（<span class="token number">24</span>小时制）
<span class="token operator">%</span>h：小时（<span class="token number">12</span>小时制）
<span class="token operator">%</span>i：分钟（<span class="token number">00</span>，<span class="token number">01</span>，<span class="token number">02</span>，<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>，<span class="token number">59</span>）
<span class="token operator">%</span>s：秒（<span class="token number">00</span>，<span class="token number">01</span>，<span class="token number">02</span>，<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>，<span class="token number">59</span>）    
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li></ul></pre> </li><li> <p>控制函数</p> 
  <ul><li>if：判断函数</li><li>case：分支函数</li></ul> <pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、<span class="token keyword">IF</span><span class="token punctuation">(</span>条件表达式，表达式<span class="token number">1</span>，表达式<span class="token number">2</span><span class="token punctuation">)</span>：如果条件表达式成立，返回表达式<span class="token number">1</span>，否则返回表达式<span class="token number">2</span>

<span class="token number">2</span>、<span class="token keyword">case</span>的格式一：
    <span class="token keyword">CASE</span> 变量或字段或表达式 
      <span class="token keyword">WHEN</span> 常量<span class="token number">1</span> <span class="token keyword">THEN</span> 值<span class="token number">1</span> 
      <span class="token keyword">WHEN</span> 常量<span class="token number">2</span> <span class="token keyword">THEN</span> 值<span class="token number">2</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token keyword">ELSE</span> 值n 
    <span class="token keyword">END</span> <span class="token punctuation">;</span>
    
<span class="token number">3</span>、<span class="token keyword">case</span>的格式二：
    <span class="token keyword">CASE</span>
      <span class="token keyword">WHEN</span> 条件<span class="token number">1</span> <span class="token keyword">THEN</span> 值<span class="token number">1</span> 
      <span class="token keyword">WHEN</span> 条件<span class="token number">2</span> <span class="token keyword">THEN</span> 值<span class="token number">2</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token keyword">ELSE</span> 值n 
    <span class="token keyword">END</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li></ul></pre> </li><li> <p>其它函数</p> 
  <ul><li>version：当前数据库的版本</li><li>database：当前打开的数据库</li><li>user：当前登录的用户</li><li>password(‘字符’)：返回该字符的密码形式</li><li>md5(‘字符’)：返回该字符的md5加密形式</li></ul> </li></ol> 
<p><strong>三、演示</strong></p> 
<p>1、concat</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">'World'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>2、substr</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#截取从指定索引处后面所有字符</span>
<span class="token keyword">SELECT</span> SUBSTR<span class="token punctuation">(</span><span class="token string">'李莫愁爱上了陆展元'</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>  <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>

<span class="token comment">#截取从指定索引处指定字符长度的字符</span>
<span class="token keyword">SELECT</span> SUBSTR<span class="token punctuation">(</span><span class="token string">'李莫愁爱上了陆展元'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>3、replace</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">'张无忌爱上了周芷若'</span><span class="token punctuation">,</span><span class="token string">'周芷若'</span><span class="token punctuation">,</span><span class="token string">'赵敏'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、upper</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> UPPER<span class="token punctuation">(</span><span class="token string">'john'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>5、lower</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> LOWER<span class="token punctuation">(</span><span class="token string">'john'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>6、lpad</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> LPAD<span class="token punctuation">(</span><span class="token string">'殷素素'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>7、rpad</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> RPAD<span class="token punctuation">(</span><span class="token string">'殷素素'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>8、length</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> LENGTH<span class="token punctuation">(</span><span class="token string">'john'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>9、trim</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#删除指定字符的左右空格</span>
<span class="token keyword">SELECT</span> LENGTH<span class="token punctuation">(</span>TRIM<span class="token punctuation">(</span><span class="token string">'    张翠山    '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>

<span class="token comment">#删除指定字符的指定字符</span>
<span class="token keyword">SELECT</span> TRIM<span class="token punctuation">(</span><span class="token string">'aaa'</span> <span class="token keyword">FROM</span> <span class="token string">'aaaaaaaaa张翠山aaaaaaaaa'</span><span class="token punctuation">)</span>  <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>10、instr</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> INSTR<span class="token punctuation">(</span><span class="token string">'杨不悔爱上了殷六侠'</span><span class="token punctuation">,</span><span class="token string">'殷六侠'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>注意：返回子串第一次出现的索引，如果找不到返回0</p> 
<p>11、round</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#默认四舍五入</span>
<span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.55</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>

<span class="token comment">#指定小数位数</span>
<span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token number">1.567</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p>注意：四舍五入和符号无关</p> 
<p>12、ceil</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> CEIL<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.02</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>注意：向上取整，返回&gt;=该参数的最小整数</p> 
<p>13、floor</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> FLOOR<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9.99</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>注意：向下取整，返回&lt;=该参数的最大整数</p> 
<p>14、mod</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token function">MOD</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>15、truncate</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">TRUNCATE</span><span class="token punctuation">(</span><span class="token number">1.69999</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>16、rand</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>17、now</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>18、curdate</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>19、curtime</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>20、year</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 年<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>21、month</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 月<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>22、day</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">DAY</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 日<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>23、hour</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">HOUR</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 时<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>24、minute</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">MINUTE</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 分<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>25、second</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">SECOND</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 秒<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>26、monthname</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> MONTHNAME<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 月名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>27、datediff</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span><span class="token string">'1995-2-7'</span><span class="token punctuation">,</span><span class="token string">'1995-2-6'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>28、date_format</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> DATE_FORMAT<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'%Y年%m月%d日'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>29、str_to_date</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> STR_TO_DATE<span class="token punctuation">(</span><span class="token string">'1998-3-2'</span><span class="token punctuation">,</span><span class="token string">'%Y-%c-%d'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>30、if</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'大'</span><span class="token punctuation">,</span> <span class="token string">'小'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> out_put<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>31、case的格式一</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">/*
案例：查询员工的工资，要求
	部门号=30，显示的工资为1.1倍
	部门号=40，显示的工资为1.2倍
	部门号=50，显示的工资为1.3倍
	其它部门，显示的工资为原工资
*/</span>

<span class="token keyword">SELECT</span> 
  salary 原始工资<span class="token punctuation">,</span>
  department_id<span class="token punctuation">,</span>
  <span class="token keyword">CASE</span>
    department_id 
    <span class="token keyword">WHEN</span> <span class="token number">30</span> <span class="token keyword">THEN</span> salary <span class="token operator">*</span> <span class="token number">1.1</span> 
    <span class="token keyword">WHEN</span> <span class="token number">40</span> <span class="token keyword">THEN</span> salary <span class="token operator">*</span> <span class="token number">1.2</span> 
    <span class="token keyword">WHEN</span> <span class="token number">50</span> <span class="token keyword">THEN</span> salary <span class="token operator">*</span> <span class="token number">1.3</span> 
    <span class="token keyword">ELSE</span> salary 
  <span class="token keyword">END</span> <span class="token keyword">AS</span> 新工资 
<span class="token keyword">FROM</span>
  employees <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li></ul></pre> 
<p>32、case的格式二</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">/*
案例：查询员工的工资情况
    如果工资&gt;20000，显示A级别
    如果工资&gt;15000，显示B级别
    如果工资&gt;10000，显示C级别
    否则，显示D级别
*/</span>

<span class="token keyword">SELECT</span> 
  salary<span class="token punctuation">,</span>
  <span class="token keyword">CASE</span>
    <span class="token keyword">WHEN</span> salary <span class="token operator">&gt;</span> <span class="token number">20000</span> <span class="token keyword">THEN</span> <span class="token string">'A'</span> 
    <span class="token keyword">WHEN</span> salary <span class="token operator">&gt;</span> <span class="token number">15000</span> <span class="token keyword">THEN</span> <span class="token string">'B'</span> 
    <span class="token keyword">WHEN</span> salary <span class="token operator">&gt;</span> <span class="token number">10000</span> <span class="token keyword">THEN</span> <span class="token string">'C'</span> 
    <span class="token keyword">ELSE</span> <span class="token string">'D'</span> 
  <span class="token keyword">END</span> <span class="token keyword">AS</span> 工资级别 
<span class="token keyword">FROM</span>
  employees <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li></ul></pre> 
<p>33、version</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> VERSION<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>34、database</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>35、user</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>36、password(‘字符’)</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>37、md5(‘字符’)</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> MD5<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t20"></a><a name="t20"></a><a id="35_884"></a>3.5、分组函数</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 函数名<span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span> 【<span class="token keyword">FROM</span> 表】<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>二、分类</strong></p> 
<ol><li> <p>sum：求和</p> </li><li> <p>avg：平均值</p> </li><li> <p>max：最大值</p> </li><li> <p>min：最小值</p> </li><li> <p>count：计算个数</p> </li></ol> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、sum、avg一般用于处理数值型，max、min、count可以处理任何类型

<span class="token number">2</span>、以上分组函数都忽略<span class="token boolean">null</span>值

<span class="token number">3</span>、可以和<span class="token keyword">distinct</span>搭配实现去重的运算：<span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> 字段<span class="token punctuation">)</span> <span class="token keyword">from</span> 表<span class="token punctuation">;</span>

<span class="token number">4</span>、一般使用<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>用作统计行数

<span class="token number">5</span>、和分组函数一同查询的字段要求是<span class="token keyword">group</span> <span class="token keyword">by</span>后的字段
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p><strong>三、演示</strong></p> 
<p>1、sum</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>2、avg</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>3、max</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、min</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>5、count</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t21"></a><a name="t21"></a><a id="36_948"></a>3.6、分组查询</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  查询列表 
<span class="token keyword">FROM</span>
  表 
【<span class="token keyword">where</span> 筛选条件】 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 分组的字段 
【<span class="token keyword">having</span> 分组后的筛选】
【<span class="token keyword">order</span> <span class="token keyword">BY</span> 排序的字段】 <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p><strong>二、特点</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、和分组函数一同查询的字段必须是<span class="token keyword">group</span> <span class="token keyword">by</span>后出现的字段

<span class="token number">2</span>、筛选分为两类：分组前筛选和分组后筛选
            	针对的表				 语句位置			   连接的关键字
	分组前筛选	 分组前的原始表			<span class="token keyword">group</span> <span class="token keyword">by</span>前			<span class="token keyword">where</span>
	分组后筛选	 分组后的结果集			<span class="token keyword">group</span> <span class="token keyword">by</span>后			<span class="token keyword">having</span>
	
<span class="token number">3</span>、分组可以按单个字段也可以按多个字段

<span class="token number">4</span>、分组可以搭配着排序使用
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li></ul></pre> 
<p><strong>三、演示</strong></p> 
<p>1、查询每个工种的员工平均工资</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>
  job_id 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> job_id <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>2、查询每个位置的员工部门个数</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  location_id 
<span class="token keyword">FROM</span>
  departments 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> location_id <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>3、查询有奖金的每个领导手下员工的平均工资</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>
  manager_id 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> commission_pct <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> manager_id <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p>4、查询哪个部门的员工个数&gt;5</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  department_id 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> department_id 
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p>5、查询每个工种有奖金的员工的最高工资&gt;6000的最高工资和公众编号，按最高工资升序</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> m<span class="token punctuation">,</span>
  job_id
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> commission_pct <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> job_id 
<span class="token keyword">HAVING</span> m <span class="token operator">&gt;</span> <span class="token number">6000</span> 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> m <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>6、查询每个工种每个部门的最低工资并按最低工资降序</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">,</span>
  job_id<span class="token punctuation">,</span>
  department_id 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> job_id<span class="token punctuation">,</span> department_id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">DESC</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<h3><a name="t22"></a><a name="t22"></a><a id="37_1053"></a>3.7、连接查询</h3> 
<p><strong>一、含义</strong></p> 
<p>连接查询又称多表查询，当查询的字段来自于多个表时，就会用到连接查询</p> 
<p><strong>二、注意</strong></p> 
<pre class="prettyprint"><code class="has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">笛卡尔乘积现象：表1 有m行，表2有n行，结果=m*n行

发生原因：没有有效的连接条件
如何避免：添加有效的连接条件
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li></ul></pre> 
<p><strong>三、分类</strong></p> 
<ol><li>按年代分类 
  <ul><li>sql92标准：支持内连接</li><li>sql99标准：支持内连接、部分外连接（左外、右外）、交叉连接</li></ul> </li><li>按功能分类 
  <ul><li>内连接 
    <ul><li>等值连接</li><li>非等值连接</li><li>自连接</li></ul> </li><li>外连接 
    <ul><li>左外连接</li><li>右外连接</li><li>全外连接</li></ul> </li><li>交叉连接</li></ul> </li></ol> 
<p><strong>四、sql92标准演示</strong></p> 
<p>1、sql92标准：等值连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询员工名和对应的部门名</span>

<span class="token keyword">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  department_name 
<span class="token keyword">FROM</span>
  employees<span class="token punctuation">,</span>
  departments 
<span class="token keyword">WHERE</span> employees<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token operator">=</span> departments<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>2、sql92标准：非等值连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询员工的工资和工资级别</span>

<span class="token keyword">SELECT</span> 
  salary<span class="token punctuation">,</span>
  grade_level 
<span class="token keyword">FROM</span>
  employees e<span class="token punctuation">,</span>
  job_grades g 
<span class="token keyword">WHERE</span> salary <span class="token operator">BETWEEN</span> g<span class="token punctuation">.</span><span class="token punctuation">`</span>lowest_sal<span class="token punctuation">`</span> <span class="token operator">AND</span> g<span class="token punctuation">.</span><span class="token punctuation">`</span>highest_sal<span class="token punctuation">`</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>3、sql92标准：自连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询员工名和它对应上级的名称</span>

<span class="token keyword">SELECT</span> 
  e<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span>
  e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>
  m<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span>
  m<span class="token punctuation">.</span>last_name 
<span class="token keyword">FROM</span>
  employees e<span class="token punctuation">,</span>
  employees m 
<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>manager_id<span class="token punctuation">`</span> <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token punctuation">`</span>employee_id<span class="token punctuation">`</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre> 
<h3><a name="t23"></a><a name="t23"></a><a id="38sql99_1130"></a>3.8、sql99标准</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  查询列表 
<span class="token keyword">FROM</span> 表<span class="token number">1</span> 别名<span class="token number">1</span> 
【连接类型】 <span class="token keyword">JOIN</span> 表<span class="token number">2</span> 别名<span class="token number">2</span> <span class="token keyword">ON</span> 连接条件 
【<span class="token keyword">where</span> 分组前筛选条件】
【<span class="token keyword">group</span> <span class="token keyword">BY</span> 分组列表】
【<span class="token keyword">having</span> 分组后筛选条件】
【<span class="token keyword">order</span> <span class="token keyword">BY</span> 排序列表】 <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p><strong>二、连接类型</strong></p> 
<ol><li>内连接：inner</li><li>外连接 
  <ul><li>左外连接：left 【outer】（左边的是主表）</li><li>右外连接：right 【outer】（右边的是主表）</li><li>全外连接：full 【outer】（两边都是主表，但是MySQL不支持全外连接、Oracle支持）</li></ul> </li><li>交叉连接：cross（交叉连接其实是用sql99语法实现笛卡尔乘积）</li></ol> 
<p><strong>三、演示</strong></p> 
<p>1、内连接：等值连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询员工名和对应的部门名</span>

<span class="token keyword">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  department_name 
<span class="token keyword">FROM</span>
  departments d 
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employees e <span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>2、内连接：非等值连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询员工的工资和工资级别</span>

<span class="token keyword">SELECT</span> 
  salary<span class="token punctuation">,</span>
  grade_level 
<span class="token keyword">FROM</span>
  employees e 
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> job_grades g <span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>salary<span class="token punctuation">`</span> <span class="token operator">BETWEEN</span> g<span class="token punctuation">.</span><span class="token punctuation">`</span>lowest_sal<span class="token punctuation">`</span> <span class="token operator">AND</span> g<span class="token punctuation">.</span><span class="token punctuation">`</span>highest_sal<span class="token punctuation">`</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>3、内连接：自连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询员工名和它对应上级的名称</span>

<span class="token keyword">SELECT</span> 
  e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>
  m<span class="token punctuation">.</span>last_name 
<span class="token keyword">FROM</span>
  employees e 
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> employees m <span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>manager_id<span class="token punctuation">`</span> <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token punctuation">`</span>employee_id<span class="token punctuation">`</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>4、外连接：左外连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询哪个部门没有员工</span>

<span class="token keyword">SELECT</span> 
  d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_name<span class="token punctuation">`</span>
<span class="token keyword">FROM</span>
  departments d 
<span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> employees e <span class="token keyword">ON</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> 
<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>employee_id<span class="token punctuation">`</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>5、外连接：右外连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询哪个部门没有员工</span>

<span class="token keyword">SELECT</span> 
  d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_name<span class="token punctuation">`</span>
<span class="token keyword">FROM</span>
  employees e 
<span class="token keyword">RIGHT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> departments d <span class="token keyword">ON</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> 
<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>employee_id<span class="token punctuation">`</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>6、交叉连接</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#使用交叉连接进行笛卡尔乘积查询</span>

<span class="token keyword">SELECT</span> 
  b<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>
  bo<span class="token punctuation">.</span><span class="token operator">*</span> 
<span class="token keyword">FROM</span> beauty b 
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> boys bo <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<h3><a name="t24"></a><a name="t24"></a><a id="39_1233"></a>3.9、子查询</h3> 
<p><strong>一、含义</strong></p> 
<p>嵌套在其它语句内部的select语句称为子查询或内查询，外面的语句可以是insert、delete、update、select等，一般select作为外面语句较多，外面如果为select语句，则此语句称为外查询或主查询</p> 
<p><strong>二、分类</strong></p> 
<ol><li>按出现的位置划分 
  <ul><li>select后面：标量子查询</li><li>from后面：表子查询</li><li>where或having后面 
    <ul><li>标量子查询</li><li>列子查询</li><li>行子查询</li></ul> </li><li>exists后面 
    <ul><li>标量子查询</li><li>列子查询</li><li>行子查询</li><li>表子查询</li></ul> </li></ul> </li><li>按结果集行列数划分 
  <ul><li>标量子查询（单行子查询）：结果集为一行一列</li><li>列子查询（多行子查询）：结果集为多行一列</li><li>行子查询：结果集为多行多列</li><li>表子查询：结果集为多行多列</li></ul> </li></ol> 
<p><strong>三、特点</strong></p> 
<ol><li>子查询放在小括号内</li><li>子查询一般放在条件的右侧</li><li>子查询的执行优先于主查询执行，主查询的条件用到了子查询的结果</li><li>标量子查询，一般搭配着单行操作符使用：&gt;、&gt;=、&lt;、&lt;=、!=、&lt;&gt;、=、&lt;=&gt;</li><li>列子查询，一般搭配着多行操作符使用：in、not in、any、some、all、exits</li></ol> 
<p><strong>四、演示</strong></p> 
<p>1、select后面</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询每个部门的员工个数</span>

<span class="token keyword">SELECT</span> 
  d<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> 
    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> 
  <span class="token keyword">FROM</span>
    employees e 
  <span class="token keyword">WHERE</span> e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span>
<span class="token punctuation">)</span> 个数 
<span class="token keyword">FROM</span>
  departments d <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre> 
<p>2、from后面</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询每个部门平均工资的工资等级</span>

<span class="token keyword">SELECT</span> 
  ag_dep<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>
  g<span class="token punctuation">.</span><span class="token punctuation">`</span>grade_level<span class="token punctuation">`</span> 
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> 
    <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> ag<span class="token punctuation">,</span>
    department_id 
  <span class="token keyword">FROM</span>
    employees 
  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> department_id
<span class="token punctuation">)</span> ag_dep 
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> job_grades g <span class="token keyword">ON</span> ag_dep<span class="token punctuation">.</span>ag <span class="token operator">BETWEEN</span> lowest_sal <span class="token operator">AND</span> highest_sal <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li></ul></pre> 
<p>3、where或having后面</p> 
<p>标量子查询：查询最低工资的员工姓名和工资</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  last_name<span class="token punctuation">,</span>
  salary 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>列子查询：</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询所有是领导的员工姓名</span>

<span class="token keyword">SELECT</span> 
  last_name 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> employee_id <span class="token operator">IN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> manager_id <span class="token keyword">FROM</span> employees
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#返回其它工种中比job_id为‘IT_PROG’工种任一工资低的员工的员工号、姓名、job_id以及salary</span>

<span class="token keyword">SELECT</span> 
  employee_id<span class="token punctuation">,</span>
  last_name<span class="token punctuation">,</span>
  job_id<span class="token punctuation">,</span>
  salary 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">&lt;</span> <span class="token keyword">ANY</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> salary <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> job_id <span class="token operator">=</span> <span class="token string">'IT_PROG'</span>
<span class="token punctuation">)</span> <span class="token operator">AND</span> job_id <span class="token operator">&lt;&gt;</span> <span class="token string">'IT_PROG'</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#返回其它部门中比job_id为‘IT_PROG’部门所有工资都低的员工的员工号、姓名、job_id以及salary</span>

<span class="token keyword">SELECT</span> 
  employee_id<span class="token punctuation">,</span>
  last_name<span class="token punctuation">,</span>
  job_id<span class="token punctuation">,</span>
  salary 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> salary <span class="token operator">&lt;</span> <span class="token keyword">ALL</span> <span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> salary <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> job_id <span class="token operator">=</span> <span class="token string">'IT_PROG'</span>
<span class="token punctuation">)</span> <span class="token operator">AND</span> job_id <span class="token operator">&lt;&gt;</span> <span class="token string">'IT_PROG'</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre> 
<p>行子查询：查询员工编号最小并且工资最高的员工信息</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  <span class="token operator">*</span> 
<span class="token keyword">FROM</span>
  employees 
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>employee_id<span class="token punctuation">,</span> salary<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>employee_id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p>4、exists后面</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询有员工的部门名</span>

<span class="token keyword">SELECT</span> 
  department_name 
<span class="token keyword">FROM</span>
  departments d 
<span class="token keyword">WHERE</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees e
	<span class="token keyword">WHERE</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span>
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li></ul></pre> 
<h3><a name="t25"></a><a name="t25"></a><a id="310_1391"></a>3.10、分页查询</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 
  查询列表 
<span class="token keyword">FROM</span>
  表<span class="token number">1</span> 别名<span class="token number">1</span>
【连接类型】 <span class="token keyword">JOIN</span> 表<span class="token number">2</span> 别名<span class="token number">2</span> <span class="token keyword">ON</span> 连接条件 
【<span class="token keyword">WHERE</span> 分组前的筛选】
【<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 分组字段】 
【<span class="token keyword">HAVING</span> 分组后的筛选 】
【<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 排序字段 <span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span>】
<span class="token keyword">LIMIT</span> 【<span class="token keyword">offset</span><span class="token punctuation">,</span> 】size <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li></ul></pre> 
<p><strong>二、特点</strong></p> 
<ol><li>limit语句放在查询语句的最后</li><li>offset代表起始索引，起始索引从0开始，size代表条目个数</li><li>分页语句：select 查询列表 from 表 limit (page-1)*size,size;</li></ol> 
<p><strong>三、演示</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询前五条员工信息</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span>  employees <span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<h3><a name="t26"></a><a name="t26"></a><a id="311_1422"></a>3.11、联合查询</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">查询语句<span class="token number">1</span>
<span class="token keyword">union</span> 【<span class="token keyword">all</span>】
查询语句<span class="token number">2</span>
<span class="token keyword">union</span> 【<span class="token keyword">all</span>】
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p><strong>二、特点</strong></p> 
<ol><li>要查询的结果来自于多个表且多个表没有直接的连接关系，但查询的信息一致时，可以使用联合查询</li><li>要求多条查询语句的查询列数是一致的</li><li>要求多条查询语句的查询的每一列的类型和顺序最好一致</li><li>union关键字默认去重，如果使用union all可以包含重复项</li></ol> 
<p><strong>三、演示</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查询中国用户中男性的信息以及外国用户中年男性的用户信息</span>

<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span>cname <span class="token keyword">FROM</span> t_ca <span class="token keyword">WHERE</span> csex<span class="token operator">=</span><span class="token string">'男'</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> t_id<span class="token punctuation">,</span>tname <span class="token keyword">FROM</span> t_ua <span class="token keyword">WHERE</span> tGender<span class="token operator">=</span><span class="token string">'male'</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<h2><a name="t27"></a><a name="t27"></a><a id="_DML_1451"></a>第四章 DML语言</h2> 
<h3><a name="t28"></a><a name="t28"></a><a id="41_1453"></a>4.1、插入语句</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#方式一：</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 表名<span class="token punctuation">(</span>字段名<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>值<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#方式二：</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 表名 <span class="token keyword">SET</span> 字段名<span class="token operator">=</span>值<span class="token punctuation">,</span>字段名<span class="token operator">=</span>值<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p><strong>二、特点</strong></p> 
<ol><li>要求值的类型和字段的类型要一致或兼容</li><li>字段的个数和顺序不一定与原始表中的字段个数和顺序一致，但必须保证值和字段一一对应</li><li>假如表中有可以为null的字段，注意可以通过以下两种方式插入null值：①字段和值都省略、②字段写上，值使用null</li><li>字段和值的个数必须一致</li><li>字段名可以省略，默认所有列</li><li>方式一支持一次插入多行，语法如下：INSERT INTO 表名【(字段名,…)】 VALUES(值,…),(值,…),…;</li><li>方式一支持子查询，语法如下：INSERT INTO 表名 查询语句;</li></ol> 
<p><strong>三、演示</strong></p> 
<p>1、方式一：插入数据</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> beauty<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sex<span class="token punctuation">,</span>borndate<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>photo<span class="token punctuation">,</span>boyfriend_id<span class="token punctuation">)</span> 
			<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token string">'唐艺昕'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'1997-12-05'</span><span class="token punctuation">,</span><span class="token string">'15633029014'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p>2、方式二：插入数据</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> beauty <span class="token keyword">SET</span> 
    id <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span>name <span class="token operator">=</span> <span class="token string">'张倩倩'</span><span class="token punctuation">,</span>
    sex <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">,</span>
    borndate <span class="token operator">=</span> <span class="token string">'1997-12-05'</span><span class="token punctuation">,</span>
    phone <span class="token operator">=</span> <span class="token string">'15633029014'</span><span class="token punctuation">,</span>
    photo <span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    boyfriend_id <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<h3><a name="t29"></a><a name="t29"></a><a id="42_1496"></a>4.2、修改语句</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、单表更新
<span class="token keyword">UPDATE</span> 表名 <span class="token keyword">SET</span> 列 <span class="token operator">=</span> 值<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WHERE</span> 查询条件<span class="token punctuation">;</span>

<span class="token number">2</span>、多表更新
<span class="token comment">#sql92语法： </span>
<span class="token keyword">UPDATE</span> 
  表<span class="token number">1</span> 别名<span class="token punctuation">,</span>
  表<span class="token number">2</span> 别名 
<span class="token keyword">SET</span>
  列 <span class="token operator">=</span> 值<span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span> 连接条件 <span class="token operator">AND</span> 筛选条件 <span class="token punctuation">;</span>

<span class="token comment">#sql99语法： </span>
<span class="token keyword">UPDATE</span> 
  表<span class="token number">1</span> 别名 
<span class="token keyword">INNER</span> <span class="token operator">|</span> <span class="token keyword">LEFT</span> <span class="token operator">|</span> <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span> 别名 <span class="token keyword">ON</span> 连接条件
  <span class="token keyword">SET</span> 列 <span class="token operator">=</span> 值<span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span> 筛选条件 <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li></ul></pre> 
<p><strong>二、演示</strong></p> 
<p>1、单表更新</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#修改beauty表中姓唐的女神的电话为13899888899</span>

<span class="token keyword">UPDATE</span> beauty <span class="token keyword">SET</span> phone <span class="token operator">=</span> <span class="token string">'13899888899'</span> <span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'唐%'</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p>2、多表更新</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#修改张无忌的女朋友的手机号为13899888899，魅力值为1000</span>
sql92语法：
<span class="token keyword">UPDATE</span> 
  boys bo<span class="token punctuation">,</span>
  beauty b 
  <span class="token keyword">SET</span> b<span class="token punctuation">.</span><span class="token punctuation">`</span>phone<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'13899888899'</span><span class="token punctuation">,</span>
      bo<span class="token punctuation">.</span><span class="token punctuation">`</span>userCP<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">1000</span> 
<span class="token keyword">WHERE</span> bo<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token punctuation">`</span>boyfriend_id<span class="token punctuation">`</span> <span class="token operator">AND</span> bo<span class="token punctuation">.</span><span class="token punctuation">`</span>boyName<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'张无忌'</span> <span class="token punctuation">;</span>

<span class="token comment">#修改张无忌的女朋友的手机号为13899888899，魅力值为1000</span>
sql99语法：
<span class="token keyword">UPDATE</span> 
  boys bo 
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> beauty b <span class="token keyword">ON</span> bo<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token punctuation">`</span>boyfriend_id<span class="token punctuation">`</span>
  <span class="token keyword">SET</span> b<span class="token punctuation">.</span><span class="token punctuation">`</span>phone<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'13899888899'</span><span class="token punctuation">,</span>
      bo<span class="token punctuation">.</span><span class="token punctuation">`</span>userCP<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">1000</span> 
<span class="token keyword">WHERE</span> bo<span class="token punctuation">.</span><span class="token punctuation">`</span>boyName<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'张无忌'</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li></ul></pre> 
<h3><a name="t30"></a><a name="t30"></a><a id="43_1555"></a>4.3、删除语句</h3> 
<p><strong>一、语法</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、单表删除 
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 表名 【<span class="token keyword">WHERE</span> 筛选条件 】<span class="token punctuation">;</span>

<span class="token number">2</span>、多表删除（级联删除）
sql92语法： 
<span class="token keyword">DELETE</span> 
  表<span class="token number">1</span>的别名<span class="token punctuation">,</span>
  表<span class="token number">2</span>的别名 
<span class="token keyword">FROM</span>
  表<span class="token number">1</span> 别名<span class="token punctuation">,</span>
  表<span class="token number">2</span> 别名 
<span class="token keyword">WHERE</span> 连接条件 <span class="token operator">AND</span> 筛选条件 <span class="token punctuation">;</span>

sql99语法： 
<span class="token keyword">DELETE</span> 
  表<span class="token number">1</span>的别名<span class="token punctuation">,</span>
  表<span class="token number">2</span>的别名 
<span class="token keyword">FROM</span>
  表<span class="token number">1</span> 别名 
<span class="token keyword">INNER</span> <span class="token operator">|</span> <span class="token keyword">LEFT</span> <span class="token operator">|</span> <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span> 别名 <span class="token keyword">ON</span> 连接条件 
<span class="token keyword">WHERE</span> 筛选条件 <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre> 
<p><strong>二、演示</strong></p> 
<p>1、单表删除</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#删除手机号以9结尾的女神信息</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> beauty <span class="token keyword">WHERE</span> phone <span class="token operator">LIKE</span> <span class="token string">'%9'</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p>2、多表删除</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#删除黄晓明的信息以及他女朋友的信息</span>
<span class="token comment">#sql92语法：</span>
<span class="token keyword">DELETE</span>
  b<span class="token punctuation">,</span>
  bo
<span class="token keyword">FROM</span>
  beauty b<span class="token punctuation">,</span>
  boys bo
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span><span class="token punctuation">`</span>boyfriend_id<span class="token punctuation">`</span> <span class="token operator">=</span> bo<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">AND</span> bo<span class="token punctuation">.</span><span class="token punctuation">`</span>boyName<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'黄晓明'</span> <span class="token punctuation">;</span> 

<span class="token comment">#删除黄晓明的信息以及他女朋友的信息</span>
<span class="token comment">#sql99语法：</span>
<span class="token keyword">DELETE</span> 
  b<span class="token punctuation">,</span>
  bo 
<span class="token keyword">FROM</span>
  beauty b 
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> boys bo <span class="token keyword">ON</span> b<span class="token punctuation">.</span><span class="token punctuation">`</span>boyfriend_id<span class="token punctuation">`</span> <span class="token operator">=</span> bo<span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> 
<span class="token keyword">WHERE</span> bo<span class="token punctuation">.</span><span class="token punctuation">`</span>boyName<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'黄晓明'</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<h2><a name="t31"></a><a name="t31"></a><a id="_DDL_1617"></a>第五章 DDL语言</h2> 
<h3><a name="t32"></a><a name="t32"></a><a id="51_1619"></a>5.1、库的管理</h3> 
<h4><a id="511_1621"></a>5.1.1、库的创建</h4> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 【<span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span>】 库名 【 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> 字符集名】<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h4><a id="512_1627"></a>5.1.2、库的修改</h4> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#它已经被废弃</span>
<span class="token keyword">RENAME</span> <span class="token keyword">DATABASE</span> 旧库名 <span class="token keyword">TO</span> 新库名<span class="token punctuation">;</span>

<span class="token comment">#修改库字符集</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> 库名 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> 字符集名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<h4><a id="513_1637"></a>5.1.3、库的删除</h4> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> 【<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span>】 库名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t33"></a><a name="t33"></a><a id="52_1643"></a>5.2、表的管理</h3> 
<h4><a id="521_1645"></a>5.2.1、表的创建</h4> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 【<span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span>】 表名 <span class="token punctuation">(</span>
  字段名 字段类型 【约束】<span class="token punctuation">,</span>
  字段名 字段类型 【约束】<span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  字段名 字段类型 【约束】
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<h4><a id="522_1656"></a>5.2.2、表的修改</h4> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、添加列
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> 列名 类型 【<span class="token keyword">FIRST</span><span class="token operator">|</span><span class="token keyword">AFTER</span> 字段名】<span class="token punctuation">;</span>

<span class="token number">2</span>、修改列的类型或约束
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 列名 新类型 【新约束】<span class="token punctuation">;</span>

<span class="token number">3</span>、修改列名
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 CHANGE <span class="token keyword">COLUMN</span> 旧列名 新列名 类型<span class="token punctuation">;</span>

<span class="token number">4</span>、删除列
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> 列名<span class="token punctuation">;</span>

<span class="token number">5</span>、修改表名
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">RENAME</span> 【<span class="token keyword">TO</span>】 新表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li></ul></pre> 
<h4><a id="523_1675"></a>5.2.3、表的删除</h4> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">方式一：<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> 【<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span>】 表名<span class="token punctuation">;</span>

方式二：<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> 【<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span>】 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<h4><a id="524_1683"></a>5.2.4、表的复制</h4> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、复制表的结构
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名 <span class="token operator">LIKE</span> 旧表<span class="token punctuation">;</span>

<span class="token number">2</span>、复制表的某些字段
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名 
<span class="token keyword">SELECT</span> 字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> 旧表 <span class="token keyword">WHERE</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token number">3</span>、复制表的结构<span class="token operator">+</span>数据
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名 
<span class="token keyword">SELECT</span> 查询列表 <span class="token keyword">FROM</span> 旧表 【<span class="token keyword">WHERE</span> 筛选条件】<span class="token punctuation">;</span>

<span class="token number">4</span>、复制表的某些字段<span class="token operator">+</span>数据
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名 
<span class="token keyword">SELECT</span> 字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> 旧表 【<span class="token keyword">WHERE</span> 筛选条件】<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li></ul></pre> 
<h3><a name="t34"></a><a name="t34"></a><a id="53_1702"></a>5.3、数据类型</h3> 
<h4><a id="531_1704"></a>5.3.1、数值型</h4> 
<p><strong>一、类型</strong></p> 
<div class="table-box"><table><thead><tr><th>类型</th><th>TINYINT</th><th>SMALLINT</th><th>MEDIUMINT</th><th>INT/INTEGER</th><th>BIGINT</th></tr></thead><tbody><tr><td>字节</td><td>1</td><td>2</td><td>3</td><td>4</td><td>8</td></tr></tbody></table></div>
<p><strong>二、特点</strong></p> 
<ol><li>都可以设置无符号和有符号，默认有符号，通过unsigned设置无符号</li><li>如果超出了范围，会报out or range异常，插入临界值（该类型的最大值或最小值即为临界值）</li><li>长度可以不指定，默认会有一个长度，长度代表显示的最大宽度，如果不够则左边用0填充，但需要搭配zerofill，并且默认变为无符号整型</li><li>如果对数据没有特殊要求，则优先考虑使用INT/INTEGER</li></ol> 
<h4><a id="532_1719"></a>5.3.2、浮点型</h4> 
<p><strong>一、类型</strong></p> 
<ol><li>定点数 
  <ul><li>DEC(M,D) ：M+2字节</li><li>DECIMAL(M,D)：M+2字节</li></ul> </li><li>浮点数 
  <ul><li>FLOAT(M,D) ：4字节</li><li>DOUBLE(M,D)：8字节</li></ul> </li></ol> 
<p><strong>二、特点</strong></p> 
<ol><li>M代表整数部位+小数部位的个数，D代表小数部位</li><li>如果超出范围，则报out or range异常，并且插入临界值（该类型的最大值或最小值即为临界值）</li><li>M和D都可以省略，但对于定点数，M默认为10，D默认为0</li><li>如果精度要求较高，则优先考虑使用定点数</li></ol> 
<h4><a id="533_1737"></a>5.3.3、字符型</h4> 
<p><strong>一、类型</strong></p> 
<div class="table-box"><table><thead><tr><th>类型</th><th>CHAR</th><th>VARCHAR</th><th>BINARY</th><th>VARBINARY</th><th>ENUM</th><th>SET</th><th>TEXT</th><th>BLOB</th></tr></thead><tbody><tr><td>描述</td><td>固定长度字符</td><td>可变长度字符</td><td>二进制字符串</td><td>二进制字符串</td><td>枚举</td><td>集合</td><td>文本</td><td>二进制大型对象</td></tr></tbody></table></div>
<p><strong>二、特点</strong></p> 
<ol><li>char：固定长度的字符，写法为char(M)，最大长度不能超过M，其中M可以省略，默认为1</li><li>varchar：可变长度的字符，写法为varchar(M)，最大长度不能超过M，其中M不可以省略</li><li>如果对数据没有特殊要求，则优先考虑使用VARCHAR</li></ol> 
<h4><a id="534_1751"></a>5.3.4、日期型</h4> 
<p><strong>一、类型</strong></p> 
<div class="table-box"><table><thead><tr><th>类型</th><th>YEAR</th><th>DATE</th><th>TIME</th><th>DATETIME</th><th>TIMESTAMP</th></tr></thead><tbody><tr><td>描述</td><td>年份</td><td>日期</td><td>时间</td><td>日期+时间</td><td>日期+时间</td></tr></tbody></table></div>
<p><strong>二、特点</strong></p> 
<ol><li>TIMESTAMP比较容易受时区、语法模式、版本的影响，更能反映当前时区的真实时间，而DATETIME则只能反映出插入时的当地时区</li><li>TIMESTAMP支持的时间范围较小，DATETIME的取值范围：1000-1-1 — 9999-12-31</li><li>TIMESTAMP的属性受Mysql版本和SQLMode的影响很大</li><li>如果对数据没有特殊要求，则优先考虑使用DATETIME</li></ol> 
<h3><a name="t35"></a><a name="t35"></a><a id="54_1766"></a>5.4、常见约束</h3> 
<p><strong>一、含义</strong></p> 
<p>约束是一种限制，用于限制表中的数据，为了保证表中的数据的准确和可靠性</p> 
<p><strong>二、分类</strong></p> 
<ol><li>NOT NULL：非空，该字段的值必填</li><li>UNIQUE：唯一，该字段的值不可重复</li><li>DEFAULT：默认，该字段的值不用手动插入有默认值</li><li>CHECK：检查，MySQL不支持</li><li>PRIMARY KEY：主键，该字段的值不可重复并且非空 unique+not null</li><li>FOREIGN KEY：外键，该字段的值引用了另外的表的字段</li></ol> 
<p><strong>三、特点</strong></p> 
<p>主键和唯一</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#不同点：</span>
<span class="token number">1</span>、一个表至多有一个主键，但可以有多个唯一
<span class="token number">2</span>、主键不允许为空，唯一可以为空

<span class="token comment">#相同点：</span>
<span class="token number">1</span>、都具有唯一性
<span class="token number">2</span>、都支持组合键，但不推荐
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p>外键</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、用于限制两个表的关系，从表的字段值引用了主表的某字段值
<span class="token number">2</span>、外键列和主表的被引用列要求类型一致，意义一样，名称无要求
<span class="token number">3</span>、主表的被引用列要求是一个<span class="token keyword">key</span>（一般就是主键）
<span class="token number">4</span>、插入数据，先插入主表；删除数据，先删除从表


可以通过以下两种方式来删除主表的记录
<span class="token comment">#方式一：级联删除</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stuinfo <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> fk_stu_major <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>majorid<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> major<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>

<span class="token comment">#方式二：级联置空</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> stuinfo <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> fk_stu_major <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>majorid<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> major<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">SET</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre> 
<p><strong>四、演示</strong></p> 
<p>1、创建表时添加约束</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名<span class="token punctuation">(</span>
	字段名 字段类型 <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token comment">#非空</span>
    字段名 字段类型 <span class="token keyword">DEFAULT</span> 值<span class="token punctuation">,</span><span class="token comment">#默认</span>
	字段名 字段类型 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span><span class="token comment">#主键</span>
	字段名 字段类型 <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span><span class="token comment">#唯一</span>
	<span class="token keyword">CONSTRAINT</span> 约束名 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>字段名<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> 主表<span class="token punctuation">(</span>被引用列<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p>注意：</p> 
<ol><li>列级约束支持：非空、默认、主键、唯一，不可以起约束名</li><li>表级约束支持：主键、唯一、外键，可以起约束名，但是在MySQL中对主键无效</li><li>列级约束可以在一个字段上追加多个，中间用空格隔开，没有顺序要求</li></ol> 
<p>2、修改表时添加或删除约束</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、非空
添加非空（列级约束）
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 字段名 字段类型 <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
删除非空
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 字段名 字段类型<span class="token punctuation">;</span>

<span class="token number">2</span>、默认
添加默认（列级约束）
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 字段名 字段类型 <span class="token keyword">DEFAULT</span> 值<span class="token punctuation">;</span>
删除默认
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 字段名 字段类型<span class="token punctuation">;</span>

<span class="token number">3</span>、主键
添加主键（列级约束）
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 字段名 字段类型 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span>
添加主键（表级约束）
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">add</span> 【<span class="token keyword">CONSTRAINT</span> 约束名】 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>字段名<span class="token punctuation">)</span><span class="token punctuation">;</span>
删除主键
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span>

<span class="token number">4</span>、唯一
添加唯一（列级约束）
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 字段名 字段类型 <span class="token keyword">UNIQUE</span><span class="token punctuation">;</span>
添加唯一（表级约束）
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">add</span> 【<span class="token keyword">CONSTRAINT</span> 约束名】 <span class="token keyword">UNIQUE</span><span class="token punctuation">(</span>字段名<span class="token punctuation">)</span><span class="token punctuation">;</span>
删除唯一
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> 索引名<span class="token punctuation">;</span>

<span class="token number">5</span>、外键
添加外键（表级约束）
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">add</span> 【<span class="token keyword">CONSTRAINT</span> 约束名】 <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>字段名<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> 主表<span class="token punctuation">(</span>被引用列<span class="token punctuation">)</span><span class="token punctuation">;</span>
删除外键
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> 约束名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li></ul></pre> 
<h3><a name="t36"></a><a name="t36"></a><a id="55_1870"></a>5.5、自增长列</h3> 
<p><strong>一、含义</strong></p> 
<p>自增长列又称为标识列，它可以不用手动的插入值，系统提供默认的序列值</p> 
<p><strong>二、特点</strong></p> 
<ol><li>不用手动插入值，可以自动提供序列值，默认从1开始，步长为1，如果要更改起始值，第一次手动插入值，后续使用NULL，如果要更改步长，修改更改系统变量：SET auto_increment_increment = 值;</li><li>一个表至多有一个自增长列</li><li>自增长列只能支持数值型</li><li>自增长列必须为一个key</li></ol> 
<p><strong>三、演示</strong></p> 
<p>1、创建表时添加自增长列</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名 <span class="token punctuation">(</span>
  字段名 字段类型 约束 <span class="token keyword">AUTO_INCREMENT</span>
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p>2、修改表时添加或删除自增长列</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">添加自增长列
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 字段名 字段类型 约束 <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">;</span>

删除自增长列
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表 <span class="token keyword">MODIFY</span> <span class="token keyword">COLUMN</span> 字段名 字段类型 约束<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<h2><a name="t37"></a><a name="t37"></a><a id="_DCL_1903"></a>第六章 DCL语言</h2> 
<p>关于授权的权限列表：</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MDkyMDQ1NDQucG5n?x-oss-process=image/format,png" alt="image-20200809204539412"></p> 
<h3><a name="t38"></a><a name="t38"></a><a id="61_1909"></a>6.1、创建用户</h3> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> 用户名@'IP地址<span class="token string">' IDENTIFIED BY '</span>密码<span class="token string">';
注意：'</span>IP地址<span class="token string">'可以设置为localhost(代表本机)或者'</span><span class="token operator">%</span>'<span class="token punctuation">(</span>代表允许所有IP地址登录<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t39"></a><a name="t39"></a><a id="62_1916"></a>6.2、删除用户</h3> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DROP</span> <span class="token keyword">USER</span> 用户名@'IP地址<span class="token string">';
注意：'</span>IP地址<span class="token string">'可以设置为localhost(代表本机)或者'</span><span class="token operator">%</span>'<span class="token punctuation">(</span>代表允许所有IP地址登录<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t40"></a><a name="t40"></a><a id="63_1923"></a>6.3、用户授权</h3> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">GRANT</span> 权限<span class="token number">1</span><span class="token punctuation">,</span>权限<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> 用户名@'IP地址<span class="token string">' IDENTIFIED BY '</span>密码'<span class="token punctuation">;</span>
注意：所有的数据库就用<span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span>，所有的权限就用<span class="token keyword">all</span>或者<span class="token keyword">all</span> <span class="token keyword">privileges</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t41"></a><a name="t41"></a><a id="64_1930"></a>6.4、撤销授权</h3> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">REVOKE</span> 权限<span class="token number">1</span><span class="token punctuation">,</span>权限<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> 用户名@'IP地址<span class="token string">' IDENTIFIED BY '</span>密码'<span class="token punctuation">;</span>
注意：所有的数据库就用<span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span>，所有的权限就用<span class="token keyword">all</span>或者<span class="token keyword">all</span> <span class="token keyword">privileges</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t42"></a><a name="t42"></a><a id="65_1937"></a>6.5、刷新授权</h3> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t43"></a><a name="t43"></a><a id="66_1943"></a>6.6、查看授权</h3> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> 用户名@'IP地址<span class="token string">';
注意：'</span>IP地址<span class="token string">'可以设置为localhost(代表本机)或者'</span><span class="token operator">%</span>'<span class="token punctuation">(</span>代表允许所有IP地址登录<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t44"></a><a name="t44"></a><a id="67_1950"></a>6.7、修改密码</h3> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#修改密码</span>
<span class="token keyword">SET</span> PASSWORD <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#登录授权</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'root'</span>@'<span class="token operator">%</span><span class="token string">' IDENTIFIED BY '</span><span class="token number">123456</span>'<span class="token punctuation">;</span>
<span class="token comment">#刷新授权</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<h3><a name="t45"></a><a name="t45"></a><a id="68_1961"></a>6.8、忘记密码</h3> 
<pre class="prettyprint"><code class="has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">1、可以在配置文件里加上 skip-grant-tables ，注意写到[mysqld]参数组下，表示跳过授权
2、重启MySQL再登录就不需要密码，进去改密码，改完后，直接 FLUSH PRIVILEGES; 就可以使用新密码来登录了
（例：UPDATE mysql.user SET PASSWORD=PASSWORD("123456") WHERE USER="root" AND HOST="localhost";）
3、改完后记得去掉配置文件例的 skip-grant-tables，重新启动MySQL服务
4、再使用新的密码登录就可以了
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<h2><a name="t46"></a><a name="t46"></a><a id="_TCL_1971"></a>第七章 TCL语言</h2> 
<h3><a name="t47"></a><a name="t47"></a><a id="71_1973"></a>7.1、事务</h3> 
<p><strong>一、含义</strong></p> 
<p>一条或多条sql语句组成一个执行单位，一组sql语句要么都执行要么都不执行</p> 
<p><strong>二、特点（ACID）</strong></p> 
<ol><li>原子性：一个事务是不可再分割的整体，要么都执行要么都不执行</li><li>一致性：一个事务的执行不能破坏数据库数据的完整性和一致性</li><li>隔离性：一个事务不受其它事务的干扰，多个事务是互相隔离的</li><li>持久性：一个事务一旦提交了，则永久的持久化到本地</li></ol> 
<p><strong>三、分类</strong></p> 
<ol><li>隐式事务：没有明显的开启和结束，本身就是一条事务可以自动提交，比如insert、update、delete</li><li>显式事务：具有明显的开启和结束，例如以下格式：</li></ol> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、开启事务
<span class="token keyword">set</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">#关闭自动提交</span>
<span class="token keyword">start</span> <span class="token keyword">transaction</span><span class="token punctuation">;</span><span class="token comment">#开启事务机制</span>

<span class="token number">2</span>、编写一组逻辑<span class="token keyword">sql</span>语句
注意：<span class="token keyword">sql</span>语句支持的是<span class="token keyword">insert</span>、<span class="token keyword">update</span>、<span class="token keyword">delete</span>

【设置回滚点，可选项】
<span class="token keyword">savepoint</span> 回滚点名<span class="token punctuation">;</span>

<span class="token number">3</span>、结束事务
提交：<span class="token keyword">commit</span><span class="token punctuation">;</span>
回滚：<span class="token keyword">rollback</span><span class="token punctuation">;</span>
回滚到指定的地方： <span class="token keyword">rollback</span> <span class="token keyword">to</span> 回滚点名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li></ul></pre> 
<h3><a name="t48"></a><a name="t48"></a><a id="72_2008"></a>7.2、事务并发（读问题）</h3> 
<p><strong>一、事物的并发问题如何发生？</strong></p> 
<p>多个事务同时操作同一个数据库的相同数据时</p> 
<p><strong>二、事务的并发问题都有哪些？</strong></p> 
<ol><li>脏读：一个事务读到了另一个事务还未提交的update数据，导致多次查询的结果不一样</li><li>不可重复读：一个事务读到了另一个事务已经提交的update数据，导致多次查询结果不一致</li><li>幻读：一个事务读到了另一个事务已经提交的insert数据，导致多次查询的结果不一样</li></ol> 
<p><strong>三、事物的并发问题如何解决？</strong></p> 
<p>通过设置隔离级别来解决并发问题</p> 
<p><strong>四、隔离级别</strong></p> 
<div class="table-box"><table><thead><tr><th>隔离级别</th><th>隔离描述</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>READ UNCOMMITTED</td><td>读未提交</td><td>×</td><td>×</td><td>×</td></tr><tr><td>READ COMMITTED</td><td>读已提交</td><td>√</td><td>×</td><td>×</td></tr><tr><td>REPEATABLE READ</td><td>可重复读</td><td>√</td><td>√</td><td>×</td></tr><tr><td>SERIALIZABLE</td><td>串行化</td><td>√</td><td>√</td><td>√</td></tr></tbody></table></div>
<p><strong>五、注意问题</strong></p> 
<ol><li> <pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql 中默认第三个隔离级别 <span class="token keyword">REPEATABLE</span> <span class="token keyword">READ</span>
oracle中默认第二个隔离级别 <span class="token keyword">READ</span> <span class="token keyword">COMMITTED</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> </li><li> <pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">查看隔离级别 <span class="token keyword">SELECT</span> @<span class="token variable">@tx_isolation</span><span class="token punctuation">;</span>
设置隔离级别 <span class="token keyword">SET</span> <span class="token keyword">SESSION</span><span class="token operator">|</span><span class="token keyword">GLOBAL</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> 隔离级别<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> </li></ol> 
<h3><a name="t49"></a><a name="t49"></a><a id="73_2045"></a>7.3、丢失更新（写问题）</h3> 
<p><strong>一、定义</strong></p> 
<p>在事务的隔离级别内容中，能够了解到两个不同的事务在并发的时候可能会发生数据的影响。细心的话可以发现事务隔离级别章节中，脏读、不可重复读、幻读三个问题都是由事务A对数据进行修改、增加，事务B总是在做读操作。如果两事务都在对数据进行修改则会导致另外的问题：丢失更新。</p> 
<p><strong>二、解决</strong></p> 
<ol><li>悲观锁：认为两个事务更新操作一定会发生丢失更新 
  <ul><li>解决：通过在语句后边添加for update来实现行级上锁，所以又称为“行级锁”，例如：select * from t_account t wheret.id=‘1’ for update;</li></ul> </li><li>乐观锁：认为事务不一定会产生丢失更新，让事务进行并发修改，不对事务进行锁定 
  <ul><li>解决：由程序员自己解决，可以通过给数据表添加自增的version字段或时间戳timestamp，进行数据修改时，数据库会检测version字段或者时间戳是否与原来的一致，若不一致，抛出异常或者重新查询</li></ul> </li></ol> 
<p><strong>三、注意</strong></p> 
<p>对于账户交易建议直接使用悲观锁，数据库的性能很高，并发度不是很高的场景两者性能没有太大差别。如果是交易减库存的操作可以考虑乐观锁，保证并发度。</p> 
<h2><a name="t50"></a><a name="t50"></a><a id="__2062"></a>第八章 高级部分</h2> 
<h3><a name="t51"></a><a name="t51"></a><a id="81_2064"></a>8.1、索引</h3> 
<p><strong>一、含义</strong></p> 
<p>索引（index）是帮助MySQL高效获取数据的一种有序的数据结构</p> 
<p><strong>二、特点</strong></p> 
<ol><li>优势： 
  <ul><li>类似于书籍的目录索引，提高数据检索的效率，降低数据库的IO成本</li><li>通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗</li></ul> </li><li>劣势： 
  <ul><li>实际上索引也是一张表，该表中保存了主键与索引字段，并指向实体类的记录，所以索引列也是要占用空间的</li><li>虽然索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE。因为更新表时，MySQL 不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，都会调整因为更新所带来的键值变化后的索引信息</li></ul> </li></ol> 
<p><strong>三、语法</strong></p> 
<p>1、创建</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> 【 <span class="token keyword">UNIQUE</span><span class="token operator">|</span>FULLTEXT<span class="token operator">|</span>SPATIAL 】 <span class="token keyword">INDEX</span> 索引名称 <span class="token keyword">ON</span> 表名<span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>2、修改</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">先删除，在创建
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>3、删除</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> 索引名称 <span class="token keyword">ON</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、查看</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>5、alter命令</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	
<span class="token comment">#这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> 索引名称<span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token comment">#添加普通索引，索引值可以出现多次。</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> 索引名称<span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token comment">#该语句指定了索引为FULLTEXT，用于全文索引	</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">ADD</span> FULLTEXT 索引名称<span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre> 
<p><strong>四、注意</strong></p> 
<p>索引的设计可以遵循一些已有的原则，创建索引的时候请尽量考虑符合这些原则，便于提升索引的使用效率，更高效的使用索引：</p> 
<ol><li>索引字段的选择，最佳候选列应当从where子句的条件中提取，如果where子句中的组合比较多，那么应当挑选最常用、过滤效果最好的列的组合</li><li>索引可以有效的提升查询数据的效率，但索引数量不是多多益善，索引越多，维护索引的代价自然也就水涨船高。对于插入、更新、删除等DML操作比较频繁的表来说，索引过多，会引入相当高的维护代价，降低DML操作的效率，增加相应操作的时间消耗。另外索引过多的话，MySQL也会犯选择困难病，虽然最终仍然会找到一个可用的索引，但无疑提高了选择的代价</li><li>对查询频次较高，且数据量比较大的表建立索引</li><li>使用唯一索引，区分度越高，使用索引的效率越高</li><li>使用短索引，索引创建之后也是使用硬盘来存储的，因此提升索引访问的I/O效率，也可以提升总体的访问效率。假如构成索引的字段总长度比较短，那么在给定大小的存储块内可以存储更多的索引值，相应的可以有效的提升MySQL访问索引的I/O效率</li><li>使用组合索引，如果查询时where子句中使用了组成该索引的前几个字段，那么这条查询SQL可以利用组合索引来提升查询效率。例如：CREATE INDEX idx_name_email_status ON tb_seller(name,email,status); 就相当于对name 创建索引；对name , email 创建了索引；对name , email, status 创建了索引</li></ol> 
<h3><a name="t52"></a><a name="t52"></a><a id="82_2132"></a>8.2、视图</h3> 
<p><strong>一、含义</strong></p> 
<p>MySQL在5.1以后推出了视图（VIEW），本身是一个虚拟表，它的数据来自于表，通过执行时动态生成</p> 
<p><strong>二、特点</strong></p> 
<ol><li>简化sql语句</li><li>提高了sql的重用性</li><li>保护基表的数据，提高了安全性</li></ol> 
<p><strong>三、语法</strong></p> 
<p>1、创建</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> 视图名
<span class="token keyword">AS</span>
查询语句<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p>2、修改</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#方式一：</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> 视图名
<span class="token keyword">AS</span>
查询语句<span class="token punctuation">;</span>

<span class="token comment">#方式二：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">VIEW</span> 视图名
<span class="token keyword">AS</span>
查询语句<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>3、删除</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> 视图<span class="token number">1</span><span class="token punctuation">,</span>视图<span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、查看</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#方式一：</span>
<span class="token keyword">DESC</span> 视图名<span class="token punctuation">;</span>

<span class="token comment">#方式二：</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> 视图名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p><strong>四、注意</strong></p> 
<p>视图一般用于查询的，而不是更新的，所以具备以下特点的视图都不允许更新：</p> 
<ol><li>包含分组函数、group by、distinct、having、union、join</li><li>常量视图</li><li>where后的子查询用到了from中的表</li><li>用到了不可更新的视图</li></ol> 
<h3><a name="t53"></a><a name="t53"></a><a id="83_2193"></a>8.3、存储过程</h3> 
<h4><a id="831_2195"></a>8.3.1、语法</h4> 
<p><strong>一、含义</strong></p> 
<p>存储过程，类似于Java中的方法，它是一组预先编译好的SQL语句的集合，理解成批处理语句</p> 
<p><strong>二、特点</strong></p> 
<ol><li>简化sql语句</li><li>提高了sql的重用性</li><li>减少了编译次数并且减少了和数据库服务器的连接次数，提高了效率</li></ol> 
<p><strong>三、语法</strong></p> 
<p>1、创建</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#标准格式如下：</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> 存储过程名<span class="token punctuation">(</span>参数模式 参数名 参数类型<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	存储过程体（一组合法的<span class="token keyword">SQL</span>语句）
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#参数模式in：参数类型是输入的</span>
<span class="token comment">#参数模式out：参数类型是输出的</span>
<span class="token comment">#参数模式inout：参数类型既可以输入也可以输出</span>

<span class="token comment">#调用in模式的参数： CALL sp1('Hello,World');</span>
<span class="token comment">#调用out模式的参数： SET @name; CALL sp1(@name); SELECT @name;</span>
<span class="token comment">#调用inout模式的参数： SET @name=值; CALL sp1(@name); SELECT @name;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li></ul></pre> 
<p>2、修改</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">先删除，在创建
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>3、删除</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> 存储过程名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、查看</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> 存储过程名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h4><a id="832_2247"></a>8.3.2、变量</h4> 
<p><strong>一、分类</strong></p> 
<ol><li>系统变量 
  <ul><li>全局变量</li><li>会话变量</li></ul> </li><li>自定义变量 
  <ul><li>用户变量</li><li>局部变量</li></ul> </li></ol> 
<p><strong>二、语法</strong></p> 
<p>1、全局变量</p> 
<p>描述：服务器层面上的，必须拥有super权限才能为系统变量赋值，作用域为整个服务器，也就是针对于所有连接（会话）有效，但不能跨重启</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、查看所有系统变量
<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES<span class="token punctuation">;</span>

<span class="token number">2</span>、查看满足条件的部分系统变量
<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%char%'</span><span class="token punctuation">;</span>

<span class="token number">3</span>、查看指定的系统变量的值
<span class="token keyword">SELECT</span> @<span class="token variable">@global</span> 系统变量名<span class="token punctuation">;</span>

<span class="token number">4</span>、为某个系统变量赋值
方式一： <span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> 系统变量名<span class="token operator">=</span>值<span class="token punctuation">;</span>
方式二： <span class="token keyword">SET</span> @<span class="token variable">@global</span> 系统变量名<span class="token operator">=</span>值<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre> 
<p>2、会话变量</p> 
<p>描述：服务器为每一个连接的客户端都提供了系统变量，作用域为当前的连接（会话）</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、查看所有系统变量
<span class="token keyword">SHOW</span> 【 <span class="token keyword">SESSION</span> 】 VARIABLES<span class="token punctuation">;</span>

<span class="token number">2</span>、查看满足条件的部分系统变量
<span class="token keyword">SHOW</span> 【 <span class="token keyword">SESSION</span> 】 VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%char%'</span><span class="token punctuation">;</span>

<span class="token number">3</span>、查看指定的系统变量的值
<span class="token keyword">SELECT</span> 【 <span class="token keyword">SESSION</span> 】系统变量名<span class="token punctuation">;</span>

<span class="token number">4</span>、为某个系统变量赋值
<span class="token keyword">SET</span> 【 <span class="token keyword">SESSION</span> 】系统变量名<span class="token operator">=</span>值<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre> 
<p>3、用户变量</p> 
<p>描述：针对于当前连接（会话）生效</p> 
<p>位置：可以在begin end里面，也可以放在外面</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、声明并赋值
<span class="token keyword">SET</span> @变量名<span class="token operator">=</span>值<span class="token punctuation">;</span> 或
<span class="token keyword">SET</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span> 或
<span class="token keyword">SELECT</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>

<span class="token number">2</span>、更新值
方式一：
	<span class="token keyword">SET</span> @变量名<span class="token operator">=</span>值<span class="token punctuation">;</span> 或
	<span class="token keyword">SET</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span> 或
	<span class="token keyword">SELECT</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>
方式二：
	<span class="token keyword">SELECT</span> xxx <span class="token keyword">INTO</span> @变量名 <span class="token keyword">FROM</span> 表<span class="token punctuation">;</span>
	
<span class="token number">3</span>、查看值
<span class="token keyword">SELECT</span> @变量名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li></ul></pre> 
<p>4、局部变量</p> 
<p>描述：作用域：仅仅在定义它的begin end中有效<br> 位置：只能放在begin end中，而且只能放在第一句</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token number">1</span>、声明并赋值
<span class="token keyword">DECLARE</span> 变量名 类型 【 <span class="token keyword">DEFAULT</span> 值 】<span class="token punctuation">;</span>

<span class="token number">2</span>、更新值
方式一：
	<span class="token keyword">SET</span> 变量名<span class="token operator">=</span>值<span class="token punctuation">;</span> 或
	<span class="token keyword">SET</span> 变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span> 或
	<span class="token keyword">SELECT</span> @变量名:<span class="token operator">=</span>值<span class="token punctuation">;</span>
方式二：
	<span class="token keyword">SELECT</span> xxx <span class="token keyword">INTO</span> 变量名 <span class="token keyword">FROM</span> 表<span class="token punctuation">;</span>
	
<span class="token number">3</span>、查看值
<span class="token keyword">SELECT</span> 变量名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li></ul></pre> 
<h4><a id="833_2342"></a>8.3.3、分支结构</h4> 
<h5><a id="8331if_2344"></a>8.3.3.1、if结构</h5> 
<p><strong>一、语法</strong></p> 
<p>注意：只能应用在begin end中</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">IF</span> 条件<span class="token number">1</span> <span class="token keyword">THEN</span> 语句<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">ELSEIF</span> 条件<span class="token number">2</span> <span class="token keyword">THEN</span> 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">ELSEIF</span> 条件<span class="token number">3</span> <span class="token keyword">THEN</span> 语句<span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
【 <span class="token keyword">ELSE</span> 语句n<span class="token punctuation">;</span> 】
<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p><strong>二、演示</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#创建函数，实现传入成绩，如果成绩&gt;90,返回A，如果成绩&gt;80,返回B，如果成绩&gt;60,返回C，否则返回D</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> test_if<span class="token punctuation">(</span>score <span class="token keyword">FLOAT</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">CHAR</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> ch <span class="token keyword">CHAR</span> <span class="token keyword">DEFAULT</span> <span class="token string">'A'</span><span class="token punctuation">;</span>
	<span class="token keyword">IF</span> score<span class="token operator">&gt;</span><span class="token number">90</span> <span class="token keyword">THEN</span> <span class="token keyword">SET</span> ch<span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSEIF</span> score<span class="token operator">&gt;</span><span class="token number">80</span> <span class="token keyword">THEN</span> <span class="token keyword">SET</span> ch<span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSEIF</span> score<span class="token operator">&gt;</span><span class="token number">60</span> <span class="token keyword">THEN</span> <span class="token keyword">SET</span> ch<span class="token operator">=</span><span class="token string">'C'</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span> <span class="token keyword">SET</span> ch<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	<span class="token keyword">RETURN</span> ch<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#函数调用</span>
<span class="token keyword">SELECT</span> test_if<span class="token punctuation">(</span><span class="token number">87</span><span class="token punctuation">)</span>$
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li></ul></pre> 
<h5><a id="8332case_2380"></a>8.3.3.2、case结构</h5> 
<p><strong>一、语法</strong></p> 
<p>注意：只能应用在begin end中</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">语法<span class="token number">1</span>：
<span class="token keyword">CASE</span> 表达式或字段
<span class="token keyword">WHEN</span> 值<span class="token number">1</span> <span class="token keyword">THEN</span> 语句<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">WHEN</span> 值<span class="token number">2</span> <span class="token keyword">THEN</span> 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
【 <span class="token keyword">ELSE</span> 语句n<span class="token punctuation">;</span> 】
<span class="token keyword">END</span> 【 <span class="token keyword">CASE</span> 】<span class="token punctuation">;</span>

语法<span class="token number">2</span>：
<span class="token keyword">CASE</span> 
<span class="token keyword">WHEN</span> 条件<span class="token number">1</span> <span class="token keyword">THEN</span> 语句<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">WHEN</span> 条件<span class="token number">2</span> <span class="token keyword">THEN</span> 语句<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
【 <span class="token keyword">ELSE</span> 语句n<span class="token punctuation">;</span> 】
<span class="token keyword">END</span> 【 <span class="token keyword">CASE</span> 】<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li></ul></pre> 
<p><strong>二、演示</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#创建函数，实现传入成绩，如果成绩&gt;90,返回A，如果成绩&gt;80,返回B，如果成绩&gt;60,返回C，否则返回D</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> test_case <span class="token punctuation">(</span>score <span class="token keyword">FLOAT</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">CHAR</span> 
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> ch <span class="token keyword">CHAR</span> <span class="token keyword">DEFAULT</span> <span class="token string">'A'</span> <span class="token punctuation">;</span>
	
	<span class="token keyword">CASE</span> 
	<span class="token keyword">WHEN</span> score<span class="token operator">&gt;</span><span class="token number">90</span> <span class="token keyword">THEN</span> <span class="token keyword">SET</span> ch<span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">;</span>
	<span class="token keyword">WHEN</span> score<span class="token operator">&gt;</span><span class="token number">80</span> <span class="token keyword">THEN</span> <span class="token keyword">SET</span> ch<span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">;</span>
	<span class="token keyword">WHEN</span> score<span class="token operator">&gt;</span><span class="token number">60</span> <span class="token keyword">THEN</span> <span class="token keyword">SET</span> ch<span class="token operator">=</span><span class="token string">'C'</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span> <span class="token keyword">SET</span> ch<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">CASE</span><span class="token punctuation">;</span>
	
	<span class="token keyword">RETURN</span> ch<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#函数调用</span>
<span class="token keyword">SELECT</span> test_case<span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<h4><a id="834_2428"></a>8.3.4、循环结构</h4> 
<p><strong>一、分类</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA3MjgxNjIxMjUucG5n?x-oss-process=image/format,png" alt="image-20200728162123754"></p> 
<p><strong>二、演示</strong></p> 
<h5><a id="8341while_2436"></a>8.3.4.1、while结构</h5> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#批量插入，根据次数插入到admin表中多条记录，如果次数&gt;20则停止</span>
<span class="token comment">#删除过程</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> test_while<span class="token punctuation">;</span>

<span class="token comment">#定义过程</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_while<span class="token punctuation">(</span><span class="token operator">IN</span> insertCount <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
	a:<span class="token keyword">WHILE</span> i<span class="token operator">&lt;=</span>insertCount <span class="token keyword">DO</span>
		<span class="token comment">#LEAVE代表Java中的break关键字；ITERATE代表Java中的continue关键字</span>
		<span class="token keyword">IF</span> i<span class="token operator">&gt;</span><span class="token number">20</span> <span class="token keyword">THEN</span> <span class="token keyword">LEAVE</span> a<span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> admin<span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'xiaohua'</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'0000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">WHILE</span> a<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用过程</span>
<span class="token keyword">CALL</span> test_while<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre> 
<h5><a id="8342repeat_2462"></a>8.3.4.2、repeat结构</h5> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#批量插入，根据次数插入到admin表中多条记录，如果次数&gt;20则停止</span>
<span class="token comment">#删除过程</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> test_repeat<span class="token punctuation">;</span>

<span class="token comment">#定义过程</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_repeat<span class="token punctuation">(</span><span class="token operator">IN</span> insertCount <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
	a:<span class="token keyword">REPEAT</span> 
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> admin<span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'xiaohua'</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'0000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
	UNTIL i<span class="token operator">&gt;</span><span class="token number">20</span>		
	<span class="token keyword">END</span> <span class="token keyword">REPEAT</span> a<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用过程</span>
<span class="token keyword">CALL</span> test_repeat<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li></ul></pre> 
<h5><a id="8343loop_2486"></a>8.3.4.3、loop结构</h5> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#批量插入，根据次数插入到admin表中多条记录，如果次数&gt;20则停止</span>
<span class="token comment">#删除过程</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> test_loop<span class="token punctuation">;</span>

<span class="token comment">#定义过程</span>
<span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_loop<span class="token punctuation">(</span><span class="token operator">IN</span> insertCount <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
	a:<span class="token keyword">LOOP</span> 
		<span class="token comment">#LEAVE代表Java中的break关键字；ITERATE代表Java中的continue关键字</span>
		<span class="token keyword">IF</span> i<span class="token operator">&gt;</span><span class="token number">20</span> <span class="token keyword">THEN</span> <span class="token keyword">LEAVE</span> a<span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> admin<span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'xiaohua'</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'0000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">LOOP</span> a<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用过程</span>
<span class="token keyword">CALL</span> test_loop<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li></ul></pre> 
<h4><a id="835_2512"></a>8.3.5、游标</h4> 
<p><strong>一、含义</strong></p> 
<p>游标是用来存储查询结果集的数据类型 , 在存储过程和函数中可以使用光标对结果集进行循环的处理</p> 
<p><strong>二、语法</strong></p> 
<p>1、声明游标</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DECLARE</span> 游标名称 <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">select</span>结果集<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>2、打开游标</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">OPEN</span> 游标名称<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>3、获取游标</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">FETCH</span> 游标名称 <span class="token keyword">INTO</span> 变量列表（需要跟<span class="token keyword">select</span>结果集的字段对应）<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、关闭游标</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CLOSE</span> 游标名称<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>三、演示</strong></p> 
<p>建数据表以用来演示</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  NAME <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
  age <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
  salary <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'薪水'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp<span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>age<span class="token punctuation">,</span>salary<span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'金毛狮王'</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">3800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'白眉鹰王'</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'青翼蝠王'</span><span class="token punctuation">,</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token number">2800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'紫衫龙王'</span><span class="token punctuation">,</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token number">1800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li></ul></pre> 
<p>循环获取该表的内容</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> getAllRowsForEmpTable<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">DECLARE</span> e_id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">DECLARE</span> e_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">DECLARE</span> e_age <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">DECLARE</span> e_salary <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">DECLARE</span> has_data <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
  
  <span class="token keyword">DECLARE</span> emp_result <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">;</span>
  <span class="token keyword">DECLARE</span> <span class="token keyword">EXIT</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> <span class="token operator">NOT</span> FOUND <span class="token keyword">SET</span> has_data<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  
  <span class="token keyword">OPEN</span> emp_result<span class="token punctuation">;</span>
  
  <span class="token keyword">REPEAT</span>
    <span class="token keyword">FETCH</span> emp_result <span class="token keyword">INTO</span> e_id<span class="token punctuation">,</span>e_name<span class="token punctuation">,</span>e_age<span class="token punctuation">,</span>e_salary<span class="token punctuation">;</span>
    <span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'id='</span><span class="token punctuation">,</span>e_id <span class="token punctuation">,</span> <span class="token string">', name='</span><span class="token punctuation">,</span>e_name<span class="token punctuation">,</span> <span class="token string">', age='</span><span class="token punctuation">,</span> e_age<span class="token punctuation">,</span> <span class="token string">', salary='</span><span class="token punctuation">,</span>e_salary<span class="token punctuation">)</span> <span class="token keyword">as</span> emp_info<span class="token punctuation">;</span>
    UNTIL has_data <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
  
  <span class="token keyword">CLOSE</span> emp_result<span class="token punctuation">;</span>
<span class="token keyword">END</span>$
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span> 
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li></ul></pre> 
<p>打开命令行调用查看</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CALL</span> getAllRowsForEmpTable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t54"></a><a name="t54"></a><a id="84_2599"></a>8.4、函数</h3> 
<p><strong>一、含义</strong></p> 
<p>其实函数就是一个有返回值的过程</p> 
<p><strong>二、语法</strong></p> 
<p>1、创建</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> 函数名<span class="token punctuation">(</span>参数名 参数类型<span class="token punctuation">)</span> 
<span class="token keyword">RETURNS</span> 返回类型
<span class="token keyword">BEGIN</span>
	函数过程体（一组合法的<span class="token keyword">SQL</span>语句）
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p>2、修改</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">先删除，在创建
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>3、删除</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> 函数名；
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、查看</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> 函数名<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>5、调用</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SELECT</span> 函数名<span class="token punctuation">(</span>实参列表<span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>三、注意</strong></p> 
<ol><li>函数体中肯定需要有return语句</li><li>存储过程和函数的区别在于函数必须有返回值，而存储过程没有</li></ol> 
<h3><a name="t55"></a><a name="t55"></a><a id="85_2648"></a>8.5、触发器</h3> 
<p><strong>一、含义</strong></p> 
<p>MySQL在5.0以后推出了触发器（TRIGGER），触发器是与表有关的数据库对象，指在 insert/update/delete 之前或之后，触发并执行触发器中定义的SQL语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性、日志记录 、数据校验等操作。使用别名 OLD 和 NEW 来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。现在MySQL触发器还只支持行级触发，不支持语句级触发</p> 
<p><strong>二、分类</strong></p> 
<div class="table-box"><table><thead><tr><th>触发器类型</th><th>NEW 和 OLD的使用</th></tr></thead><tbody><tr><td>INSERT 型触发器</td><td>NEW 表示将要或者已经新增的数据</td></tr><tr><td>UPDATE 型触发器</td><td>OLD 表示修改之前的数据 , NEW 表示将要或已经修改后的数据</td></tr><tr><td>DELETE 型触发器</td><td>OLD 表示将要或者已经删除的数据</td></tr></tbody></table></div>
<p><strong>三、语法</strong></p> 
<p>1、创建</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> 触发器名称 
BEFORE<span class="token operator">/</span><span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span><span class="token operator">/</span><span class="token keyword">UPDATE</span><span class="token operator">/</span><span class="token keyword">DELETE</span>
<span class="token keyword">ON</span> 表名称 
【 <span class="token keyword">FOR EACH ROW</span> 】<span class="token comment">--行级触发器</span>
<span class="token keyword">BEGIN</span>
	触发器过程体（一组合法的<span class="token keyword">SQL</span>语句）
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>2、更新</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">先删除，在创建
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>3、删除</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> 触发器名称<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、查看</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SHOW</span> TRIGGERS<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>四、演示</strong></p> 
<p>创建数据表以用来演示</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  NAME <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
  age <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
  salary <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'薪水'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp<span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>age<span class="token punctuation">,</span>salary<span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'金毛狮王'</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">3800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'白眉鹰王'</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'青翼蝠王'</span><span class="token punctuation">,</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token number">2800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'紫衫龙王'</span><span class="token punctuation">,</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token number">1800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp_logs <span class="token punctuation">(</span>
  id <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  operation <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作类型, insert/update/delete'</span><span class="token punctuation">,</span>
  operate_time <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作时间'</span><span class="token punctuation">,</span>
  operate_id <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作表的ID'</span><span class="token punctuation">,</span>
  operate_params <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'操作参数'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8 <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li></ul></pre> 
<p>编写触发器进行测试</p> 
<p>创建 insert 型触发器，完成插入数据时的日志记录：</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> emp_logs_insert_trigger
<span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> 
<span class="token keyword">ON</span> emp 
<span class="token keyword">FOR EACH ROW</span> 
<span class="token keyword">BEGIN</span>
  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp_logs <span class="token punctuation">(</span>id<span class="token punctuation">,</span>operation<span class="token punctuation">,</span>operate_time<span class="token punctuation">,</span>operate_id<span class="token punctuation">,</span>operate_params<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'insert'</span><span class="token punctuation">,</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>id<span class="token punctuation">,</span>CONCAT<span class="token punctuation">(</span><span class="token string">'插入后(id:'</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token string">', name:'</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">', age:'</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>age<span class="token punctuation">,</span><span class="token string">', salary:'</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>salary<span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>创建 update 型触发器，完成更新数据时的日志记录：</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> emp_logs_update_trigger
<span class="token keyword">AFTER</span> <span class="token keyword">UPDATE</span> 
<span class="token keyword">ON</span> emp 
<span class="token keyword">FOR EACH ROW</span> 
<span class="token keyword">BEGIN</span>
  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp_logs <span class="token punctuation">(</span>id<span class="token punctuation">,</span>operation<span class="token punctuation">,</span>operate_time<span class="token punctuation">,</span>operate_id<span class="token punctuation">,</span>operate_params<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'update'</span><span class="token punctuation">,</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>id<span class="token punctuation">,</span>CONCAT<span class="token punctuation">(</span><span class="token string">'修改前(id:'</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token string">', name:'</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">', age:'</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>age<span class="token punctuation">,</span><span class="token string">', salary:'</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>salary<span class="token punctuation">,</span><span class="token string">') , 修改后(id'</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'name:'</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">', age:'</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>age<span class="token punctuation">,</span><span class="token string">', salary:'</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>salary<span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                      
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>创建delete 行的触发器 , 完成删除数据时的日志记录：</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> emp_logs_delete_trigger
<span class="token keyword">AFTER</span> <span class="token keyword">DELETE</span> 
<span class="token keyword">ON</span> emp 
<span class="token keyword">FOR EACH ROW</span> 
<span class="token keyword">BEGIN</span>
  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp_logs <span class="token punctuation">(</span>id<span class="token punctuation">,</span>operation<span class="token punctuation">,</span>operate_time<span class="token punctuation">,</span>operate_id<span class="token punctuation">,</span>operate_params<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'delete'</span><span class="token punctuation">,</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>id<span class="token punctuation">,</span>CONCAT<span class="token punctuation">(</span><span class="token string">'删除前(id:'</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>id<span class="token punctuation">,</span><span class="token string">', name:'</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">', age:'</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>age<span class="token punctuation">,</span><span class="token string">', salary:'</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>salary<span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                      
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre> 
<p>依次调用以下的语句，查看emp_logs是否有触发器保存的日志记录</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp<span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>age<span class="token punctuation">,</span>salary<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'光明左使'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">3500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> emp <span class="token keyword">SET</span> age <span class="token operator">=</span> <span class="token number">39</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<h3><a name="t56"></a><a name="t56"></a><a id="86_2779"></a>8.6、事件</h3> 
<p><strong>一、含义</strong></p> 
<p>MySQL在5.1以后推出了事件调度器（Event Scheduler），与triggers的事件触发不同，event类似与linux crontab计划任务，用于时间触发</p> 
<p><strong>二、特点</strong></p> 
<ol><li>事件是一组SQL集合，简单说就是mysql中的定时器，时间到了就执行</li><li>事件由一个特定的线程来管理的，也就是所谓的事件调度器，但是事件不能直接调用，通过单独或调用存储过程使用，在某一特定的时间点，触发相关的SQL语句或存储过程</li></ol> 
<p><strong>三、语法</strong></p> 
<p>1、创建</p> 
<p>MySQL事件调度器event_scheduler负责调用事件，它默认是关闭的。这个调度器不断地监视一个事件是否要调用， 要创建事件，必须打开调度器。</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#开启事件调度器（任意一个都可以）</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> event_scheduler <span class="token operator">=</span> <span class="token keyword">ON</span><span class="token punctuation">;</span> 
<span class="token keyword">SET</span> @<span class="token variable">@global.event_scheduler</span> <span class="token operator">=</span> <span class="token keyword">ON</span><span class="token punctuation">;</span> 
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> event_scheduler <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token keyword">SET</span> @<span class="token variable">@global.event_scheduler</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 

<span class="token comment">#关闭事件调度器（任意一个都可以）</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> event_scheduler <span class="token operator">=</span> <span class="token keyword">OFF</span><span class="token punctuation">;</span> 
<span class="token keyword">SET</span> @<span class="token variable">@global.event_scheduler</span> <span class="token operator">=</span> <span class="token keyword">OFF</span><span class="token punctuation">;</span> 
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> event_scheduler <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">SET</span> @<span class="token variable">@global.event_scheduler</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li></ul></pre> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DELIMITER</span> $
<span class="token keyword">CREATE</span> EVENT 事件名称
<span class="token keyword">ON</span> SCHEDULE 执行时间和频率
<span class="token comment">-- 执行时间和频率有两种形式AT和EVERY</span>
<span class="token comment">-- 	使用 AT     关键字只会执行一次，格式如下：</span>
<span class="token comment">-- 	AT CURRENT_TIMESTAMP 或者 'YYYY-MM-DD HH:MM.SS'</span>
<span class="token comment">-- 	使用 EVERY  关键字指定时间间隔，格式如下：</span>
<span class="token comment">-- 	EVERY 1 [HOUR|MONTH|WEEK|DAY|MINUTE|...]</span>

<span class="token comment">-- 可选项，使用 STARTS 关键字指定开始时间，格式如下：</span>
<span class="token comment">-- STARTS CURRENT_TIMESTAMP 或者 'YYYY-MM-DD HH:MM.SS'</span>
<span class="token comment">-- 可选项，使用 ENDS   关键字指定结束时间，格式如下：</span>
<span class="token comment">-- ENDS CURRENT_TIMESTAMP 或者 'YYYY-MM-DD HH:MM.SS'</span>

<span class="token comment">-- [ON COMPLETION [NOT] PRESERVE] </span>
<span class="token comment">-- 可选项，设定event的生命</span>
<span class="token comment">--		ON COMPLETION NOT PRESERVE ：即计划任务执行完毕后自动drop该事件（默认）</span>
<span class="token comment">--		ON COMPLETION PRESERVE     ：即计划任务执行完毕后不会drop该事件</span>

<span class="token comment">-- [ENABLE | DISABLE] </span>
<span class="token comment">-- 可选项，设定event的状态</span>
<span class="token comment">--		ENABLE	：表示系统尝试执行这个事件（默认）</span>
<span class="token comment">--		DISABLE	：表示系统尝试关闭这个事件</span>

<span class="token comment">-- [COMMENT 'comment'] </span>
<span class="token comment">-- 可选项，设定event的备注</span>
<span class="token keyword">DO</span>
<span class="token keyword">BEGIN</span>
        <span class="token comment">/* 在这里写SQL语句或者调用存储过程 */</span>
<span class="token keyword">END</span>$
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li></ul></pre> 
<p>2、修改</p> 
<pre class="prettyprint"><code class="prism language-java has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">先删除，在创建
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>3、删除</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">DROP</span> EVENT 事件名称<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>4、查看</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">SHOW</span> EVENTS<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>5、调用</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#启用事件</span>
<span class="token keyword">ALTER</span> EVENT 事件名称 <span class="token keyword">ENABLE</span><span class="token punctuation">;</span>

<span class="token comment">#禁用事件</span>
<span class="token keyword">ALTER</span> EVENT 事件名称 <span class="token keyword">DISABLE</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<p><strong>四、注意</strong></p> 
<ol><li>默认创建事件存储在当前库中，也可显示指定事件创建在哪个库中</li><li>通过show events只能查看当前库中创建的事件</li><li>事件执行完即释放，如立即执行事件，执行完后，事件便自动删除，多次调用事件或等待执行事件可以查看到</li><li>如果两个事件需要在同一时刻调用，mysql会确定调用他们的顺序，如果要指定顺序，需要确保一个事件至少在另一个事件1秒后执行</li><li>对于递归调度的事件，结束日期不能在开始日期之前</li><li>select可以包含在一个事件中，然而他的结果消失了，就好像没执行过</li></ol> 
<h2><a name="t57"></a><a name="t57"></a><a id="__2881"></a>第九章 数据备份与恢复</h2> 
<h3><a name="t58"></a><a name="t58"></a><a id="91_2883"></a>9.1、数据导出</h3> 
<p>1、导出某张数据表</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#格式：mysqldump -u账户 -p密码 数据库名 数据表名 &gt; 文件保存路径</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p123456 test emp <span class="token operator">&gt;</span> D:<span class="token operator">/</span>emp<span class="token punctuation">.</span><span class="token keyword">sql</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p>2、导出整个数据库</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#格式：mysqldump -u账户 -p密码 数据库名 &gt; 文件保存路径</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p123456 test <span class="token operator">&gt;</span> D:<span class="token operator">/</span>test<span class="token punctuation">.</span><span class="token keyword">sql</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t59"></a><a name="t59"></a><a id="92_2899"></a>9.2、数据导入</h3> 
<p>1、导入某张数据表</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#格式：mysql -u账户 -p密码</span>
<span class="token comment">#     use 数据库名;</span>
<span class="token comment">#     source 文件保存路径</span>
mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p123456
<span class="token operator">&gt;</span><span class="token keyword">use</span> test<span class="token punctuation">;</span>
<span class="token operator">&gt;</span>source D:<span class="token operator">/</span>emp<span class="token punctuation">.</span><span class="token keyword">sql</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>2、导入整个数据库</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#格式：mysql -u账户 -p密码 &lt; 文件保存路径</span>
mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p123456 <span class="token operator">&lt;</span> test<span class="token punctuation">.</span><span class="token keyword">sql</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h2><a name="t60"></a><a name="t60"></a><a id="_MySQL_2919"></a>第十章 安装MySQL单实例</h2> 
<h3><a name="t61"></a><a name="t61"></a><a id="101_2921"></a>10.1、准备虚拟机</h3> 
<p><strong>虚拟机配置：全新系统，桌面版</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjQyMzQyMzAucG5n?x-oss-process=image/format,png" alt="image-20200824234229205"></p> 
<p><strong>虚拟机地址：进入系统，可上网</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjQyMjUyMTAucG5n?x-oss-process=image/format,png" alt="image-20200824225209337"></p> 
<p><strong>连接的工具：自行百度，在下载</strong></p> 
<p>SecureCRT：7.0.0</p> 
<h3><a name="t62"></a><a name="t62"></a><a id="102_2935"></a>10.2、删除自带库</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rpm -qa | grep mysql</span>
mysql-libs-5.1.73-8.el6_8.x86_64
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rpm -e mysql-libs-5.1.73-8.el6_8.x86_64 --nodeps</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<h3><a name="t63"></a><a name="t63"></a><a id="103_2943"></a>10.3、安装依赖包</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># yum -y install numactl perl libaio wget</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t64"></a><a name="t64"></a><a id="104_2949"></a>10.4、下载服务端</h3> 
<p><strong>下载：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># wget https://cdn.mysql.com//Downloads/MySQL-5.6/MySQL-server-5.6.49-1.el6.x86_64.rpm</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>查看：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># ll MySQL-server-5.6.49-1.el6.x86_64.rpm</span>
-rw-r--r--. 1 root root 65467136 6月   3 13:36 MySQL-server-5.6.49-1.el6.x86_64.rpm
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t65"></a><a name="t65"></a><a id="105_2964"></a>10.5、安装服务端</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh MySQL-server-5.6.49-1.el6.x86_64.rpm</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t66"></a><a name="t66"></a><a id="106_2970"></a>10.6、下载客户端</h3> 
<p><strong>下载：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># wget https://cdn.mysql.com//Downloads/MySQL-5.6/MySQL-client-5.6.49-1.el6.x86_64.rpm</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>查看：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># ll MySQL-client-5.6.49-1.el6.x86_64.rpm</span>
-rw-r--r--. 1 root root 21584380 6月   3 13:36 MySQL-client-5.6.49-1.el6.x86_64.rpm
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t67"></a><a name="t67"></a><a id="107_2985"></a>10.7、安装客户端</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh MySQL-client-5.6.49-1.el6.x86_64.rpm</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t68"></a><a name="t68"></a><a id="108_2991"></a>10.8、启动数据库服务</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># service mysql start</span>
Starting MySQL.Logging to <span class="token string">'/var/lib/mysql/caochenlei.err'</span><span class="token keyword">.</span>
<span class="token punctuation">..</span>                                                         <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<h3><a name="t69"></a><a name="t69"></a><a id="109_2999"></a>10.9、查看初始化密码</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># cat /root/.mysql_secret</span>
<span class="token comment"># The random password set for the root user at Mon Aug 24 23:06:53 2020 (local time): E4qT_4CJ9YNf0daG</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t70"></a><a name="t70"></a><a id="1010_3006"></a>10.10、修改初始化密码</h3> 
<p><strong>登录：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -pE4qT_4CJ9YNf0daG</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>修改：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> password <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t71"></a><a name="t71"></a><a id="1011_3021"></a>10.11、远程的授权</h3> 
<p><strong>授权：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'root'</span>@'<span class="token operator">%</span><span class="token string">' identified by '</span><span class="token number">123456</span>'<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>刷新：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>退出：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">exit</span>
Bye
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t72"></a><a name="t72"></a><a id="1012_3044"></a>10.12、开放防火墙</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /sbin/iptables -I INPUT -p tcp --dport 3306 -j ACCEPT</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /etc/rc.d/init.d/iptables save</span>
iptables：将防火墙规则保存到 /etc/sysconfig/iptables：     <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<h3><a name="t73"></a><a name="t73"></a><a id="1013_3052"></a>10.13、添加自启动</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># chkconfig --add mysql</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># chkconfig mysql on</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t74"></a><a name="t74"></a><a id="1014_3059"></a>10.14、测试连接</h3> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjQyMzIxMjEucG5n?x-oss-process=image/format,png" alt="image-20200824232120251"></p> 
<h3><a name="t75"></a><a name="t75"></a><a id="1015_3063"></a>10.15、关闭系统</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># poweroff</span>

Broadcast message from root@caochenlei
        <span class="token punctuation">(</span>/dev/pts/1<span class="token punctuation">)</span> at 23:24 <span class="token punctuation">..</span>.

The system is going down <span class="token keyword">for</span> power off NOW<span class="token operator">!</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<h2><a name="t76"></a><a name="t76"></a><a id="_MySQL_3074"></a>第十一章 安装MySQL主从复制</h2> 
<h3><a name="t77"></a><a name="t77"></a><a id="111_3076"></a>11.1、准备虚拟机</h3> 
<p><strong>复制CentOS 6 64 bit-1 &gt; CentOS 6 64 bit-2</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjQyMzMzMTUucG5n?x-oss-process=image/format,png" alt="image-20200824233313817"></p> 
<p><strong>启动CentOS 6 64 bit-1：</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjQyMzM2NDgucG5n?x-oss-process=image/format,png" alt="image-20200824233645840"></p> 
<p><strong>启动CentOS 6 64 bit-2：选择“我已复制该虚拟机”</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjQyMzQxMTEucG5n?x-oss-process=image/format,png" alt="image-20200824234110546"></p> 
<h3><a name="t78"></a><a name="t78"></a><a id="112_3090"></a>11.2、主从复制介绍</h3> 
<p>主从复制允许将来自一个MySQL数据库服务器（主服务器）的数据复制到一个或多个MySQL数据库服务器（从服务器）。</p> 
<h3><a name="t79"></a><a name="t79"></a><a id="113_3094"></a>11.3、主从复制架构</h3> 
<p>实现目标：一主一从</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUwMDM2MzIucG5n?x-oss-process=image/format,png" alt="image-20200825003631169"></p> 
<h3><a name="t80"></a><a name="t80"></a><a id="114_3100"></a>11.4、主节点配置</h3> 
<p><strong>编辑：</strong></p> 
<blockquote> 
 <p>注意：192.168.206.128为主节点</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/my.cnf</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>添加：</strong></p> 
<blockquote> 
 <p>注意：在[mysqld]下一行添加以下信息</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#日志名称</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment">#日志格式：row、statement、mixed</span>
binlog-format<span class="token operator">=</span>row
<span class="token comment">#服务器ID标识</span>
server-id<span class="token operator">=</span>1
<span class="token comment">#刷写事务日志</span>
innodb_flush_log_at_trx_commit<span class="token operator">=</span>1
<span class="token comment">#执行写入1次同步1次</span>
sync_binlog<span class="token operator">=</span>1
<span class="token comment">#及时更新master_info</span>
sync_master_info<span class="token operator">=</span>1
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li></ul></pre> 
<p><strong>重启：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># service mysql restart</span>
Shutting down MySQL<span class="token punctuation">..</span>.                                     <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
Starting MySQL<span class="token punctuation">..</span><span class="token punctuation">..</span>.                                        <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p><strong>连接：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p123456</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>授权：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">grant</span> <span class="token keyword">replication</span> slave <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'root'</span>@'<span class="token operator">%</span><span class="token string">' identified by '</span><span class="token number">123456</span>'<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>刷新：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>查看：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> master <span class="token keyword">status</span>\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
             <span class="token keyword">File</span>: mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span>
         Position: <span class="token number">397</span>
     Binlog_Do_DB: 
 Binlog_Ignore_DB: 
Executed_Gtid_Set: 
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<h3><a name="t81"></a><a name="t81"></a><a id="115_3170"></a>11.5、从节点配置</h3> 
<p><strong>编辑：</strong></p> 
<blockquote> 
 <p>注意：192.168.206.129为从节点</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/my.cnf</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>添加：</strong></p> 
<blockquote> 
 <p>注意：在[mysqld]下一行添加以下信息</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#日志名称</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token comment">#日志格式：row、statement、mixed</span>
binlog-format<span class="token operator">=</span>row
<span class="token comment">#服务器ID标识</span>
server-id<span class="token operator">=</span>2
<span class="token comment">#是否只读</span>
read_only<span class="token operator">=</span>1
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p><strong>停止：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># service mysql stop</span>
Shutting down MySQL<span class="token punctuation">..</span>                                      <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>删除：</strong></p> 
<blockquote> 
 <p>注意：这里不能直接重启mysql是因为它们的auto.cnf中的server-uuid是一样的，在进行接下来的配置的时候会失败，所以要删除从库的server-uuid，让它在启动的时候自动生成一个全新的server-uuid</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rm -f /var/lib/mysql/auto.cnf</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>启动：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># service mysql start</span>
Starting MySQL<span class="token punctuation">..</span>.                                          <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>连接：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p123456</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>执行：</strong></p> 
<blockquote> 
 <p>注意：MASTER_LOG_FILE=show master status的File、MASTER_LOG_POS=show master status的Position</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">CHANGE MASTER <span class="token keyword">TO</span>
MASTER_HOST<span class="token operator">=</span><span class="token string">'192.168.206.128'</span><span class="token punctuation">,</span>
MASTER_PORT<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>
MASTER_USER<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
MASTER_PASSWORD<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span>
MASTER_LOG_FILE<span class="token operator">=</span><span class="token string">'mysql-bin.000001'</span><span class="token punctuation">,</span>
MASTER_LOG_POS<span class="token operator">=</span><span class="token number">397</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p><strong>开启：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">start</span> slave<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>查看：</strong></p> 
<blockquote> 
 <p>注意：重点检查Master_Log_File、Read_Master_Log_Pos是否和主节点的信息一致，Slave_IO_Running、Slave_SQL_Running是否为YES</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">show</span> slave <span class="token keyword">status</span>\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
               Slave_IO_State: Waiting <span class="token keyword">for</span> master <span class="token keyword">to</span> send event
                  Master_Host: <span class="token number">192.168</span><span class="token number">.206</span><span class="token number">.128</span>
                  Master_User: root
                  Master_Port: <span class="token number">3306</span>
                Connect_Retry: <span class="token number">60</span>
              Master_Log_File: mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span>
          Read_Master_Log_Pos: <span class="token number">397</span>
               Relay_Log_File: caochenlei<span class="token operator">-</span>relay<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000002</span>
                Relay_Log_Pos: <span class="token number">283</span>
        Relay_Master_Log_File: mysql<span class="token operator">-</span>bin<span class="token punctuation">.</span><span class="token number">000001</span>
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
              Replicate_Do_DB: 
          Replicate_Ignore_DB: 
           Replicate_Do_Table: 
       Replicate_Ignore_Table: 
      Replicate_Wild_Do_Table: 
  Replicate_Wild_Ignore_Table: 
                   Last_Errno: <span class="token number">0</span>
                   Last_Error: 
                 Skip_Counter: <span class="token number">0</span>
          Exec_Master_Log_Pos: <span class="token number">397</span>
              Relay_Log_Space: <span class="token number">461</span>
              Until_Condition: None
               Until_Log_File: 
                Until_Log_Pos: <span class="token number">0</span>
           Master_SSL_Allowed: <span class="token keyword">No</span>
           Master_SSL_CA_File: 
           Master_SSL_CA_Path: 
              Master_SSL_Cert: 
            Master_SSL_Cipher: 
               Master_SSL_Key: 
        Seconds_Behind_Master: <span class="token number">0</span>
Master_SSL_Verify_Server_Cert: <span class="token keyword">No</span>
                Last_IO_Errno: <span class="token number">0</span>
                Last_IO_Error: 
               Last_SQL_Errno: <span class="token number">0</span>
               Last_SQL_Error: 
  Replicate_Ignore_Server_Ids: 
             Master_Server_Id: <span class="token number">1</span>
                  Master_UUID: d7200ffb<span class="token operator">-</span>e698<span class="token operator">-</span><span class="token number">11</span>ea<span class="token operator">-</span><span class="token number">87</span>e0<span class="token operator">-</span><span class="token number">000</span>c29e99cce
             Master_Info_File: <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>master<span class="token punctuation">.</span>info
                    SQL_Delay: <span class="token number">0</span>
          SQL_Remaining_Delay: <span class="token boolean">NULL</span>
      Slave_SQL_Running_State: Slave has <span class="token keyword">read</span> <span class="token keyword">all</span> relay log<span class="token punctuation">;</span> waiting <span class="token keyword">for</span> the slave I<span class="token operator">/</span>O thread <span class="token keyword">to</span> <span class="token keyword">update</span> it
           Master_Retry_Count: <span class="token number">86400</span>
                  Master_Bind: 
      Last_IO_Error_Timestamp: 
     Last_SQL_Error_Timestamp: 
               Master_SSL_Crl: 
           Master_SSL_Crlpath: 
           Retrieved_Gtid_Set: 
            Executed_Gtid_Set: 
                Auto_Position: <span class="token number">0</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li><li style="color: rgb(153, 153, 153);">54</li><li style="color: rgb(153, 153, 153);">55</li><li style="color: rgb(153, 153, 153);">56</li><li style="color: rgb(153, 153, 153);">57</li></ul></pre> 
<h3><a name="t82"></a><a name="t82"></a><a id="116_3308"></a>11.6、连接测试</h3> 
<p><strong>测试连接：192.168.206.128（master）</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUwMTQxMDQucG5n?x-oss-process=image/format,png" alt="image-20200825014102540"></p> 
<p><strong>创建数据库：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">`</span>mytest<span class="token punctuation">`</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>创建数据表：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>mytest<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>myuser<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">BIGINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p><strong>添加数据集：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>mytest<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>myuser<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>mytest<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>myuser<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'lisi'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>mytest<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>myuser<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'wangwu'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p><strong>查看数据集：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">use</span> mytest<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> myuser<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>连接测试：192.168.206.129（slave）</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUwMTQ3MzEucG5n?x-oss-process=image/format,png" alt="image-20200825014729798"></p> 
<p><strong>查看数据集：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">USE</span> mytest<span class="token punctuation">;</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> myuser<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>最终的结论：</strong></p> 
<p>我们会发现我们只在192.168.206.128（master）创建数据库、创建表、添加数据，而它的从节点会自动的拉取主节点的内容，这就是所谓的主从复制了。</p> 
<h2><a name="t83"></a><a name="t83"></a><a id="_MySQL_3361"></a>第十二章 安装MySQL读写分离</h2> 
<h3><a name="t84"></a><a name="t84"></a><a id="121_3363"></a>12.1、环境准备</h3> 
<p><strong>复制CentOS 6 64 bit-2 &gt; CentOS 6 64 bit-3</strong></p> 
<blockquote> 
 <p>注意：因为CentOS 6 64 bit-2已经是配置好的slave节点了，我们只需要做少量修改就能实现一主两从的架构了，所以我们复制CentOS 6 64 bit-2，当然，你要是时间允许，机器性能允许，您也可以重新按照主从复制的步骤在搭建一台slave，在这里我们就不搭建了，只是进行一下复制修改，复制的时候，注意关机，先关闭slave，再关闭master，再复制，再重命名，先启动master，在启动slave，在启动新复制的那台slave</p> 
</blockquote> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUxMTExMTkucG5n?x-oss-process=image/format,png" alt="image-20200825111116521"></p> 
<p><strong>启动CentOS 6 64 bit-3：选择“我已复制该虚拟机”</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUxNDI1MjkucG5n?x-oss-process=image/format,png" alt="image-20200825142527374"></p> 
<h3><a name="t85"></a><a name="t85"></a><a id="122_3375"></a>12.2、读写分离介绍</h3> 
<p>以上已经完成了主从复制（一主一从）配置，然而这只是一个基本配置，加上一个proxysql实现MySQL读写分离，proxysql支持MySQL协议的的数据库代理，程序访问的不再是具体的数据库，而是proxysql这个代理程序，用户请求发向proxysql，如果是写请求发往主节点，读请求发下从节点组中，以此实现读写分离一定程序上减轻了主数据库的io压力。</p> 
<h3><a name="t86"></a><a name="t86"></a><a id="123_3379"></a>12.3、读写分离架构</h3> 
<p>实现目标：一主两从，基于上文中的一主一从，我们重新复制一个从节点，进行少量修改即可</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUyMDEwNTUucG5n?x-oss-process=image/format,png" alt="image-20200825201051126"></p> 
<h3><a name="t87"></a><a name="t87"></a><a id="124_3385"></a>12.4、修改从节点二</h3> 
<blockquote> 
 <p>注意：主节点：CentOS 6 64 bit-1【128】、从节点一：CentOS 6 64 bit-2【129】、从节点二：CentOS 6 64 bit-3【130】</p> 
</blockquote> 
<p><strong>停止：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># service mysql stop</span>
Shutting down MySQL<span class="token punctuation">..</span>                                      <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>删除：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rm -f /var/lib/mysql/auto.cnf</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>修改：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/my.cnf</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#服务器ID标识</span>
server-id<span class="token operator">=</span>3
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>启动：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># service mysql start</span>
Starting MySQL<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.                                      <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>登录：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p123456</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>查看：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">USE</span> mytest<span class="token punctuation">;</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> myuser<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>测试：</strong></p> 
<p>第一步：在主节点（192.168.206.128）插入数据</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>mytest<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>myuser<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'xiaojiu'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">USE</span> mytest<span class="token punctuation">;</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> myuser<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li></ul></pre> 
<p>第二步：在从节点（192.168.206.129）查看数据</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">USE</span> mytest<span class="token punctuation">;</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> myuser<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p>第三步：在从节点（192.168.206.130）查看数据</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">USE</span> mytest<span class="token punctuation">;</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> myuser<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<blockquote> 
 <p>注意：如果说从节点一或者从节点二有一个不正常工作，也就是不能主从复制，主要是它们的服务器ID标识复制的时候是一样的，开机因为已经添加了自启动，所以肯定会冲突，有一个不能够连接到主节点，只要这个时候重启一下不能正常工作的那台机器的mysql服务就行了，因为从节点二我们已经修改server-id=3了，这样它们两个从节点肯定不会冲突了，到这里，一主两从的模式就搭建好了，接下来就是配置读写分离了。</p> 
</blockquote> 
<h3><a name="t88"></a><a name="t88"></a><a id="125proxysql_3460"></a>12.5、安装proxysql</h3> 
<p><strong>设下载源：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> EOF <span class="token operator">|</span> <span class="token function">tee</span> /etc/yum.repos.d/proxysql.repo
<span class="token punctuation">[</span>proxysql_repo<span class="token punctuation">]</span>
name<span class="token operator">=</span> ProxySQL YUM repository
baseurl<span class="token operator">=</span>https://repo.proxysql.com/ProxySQL/proxysql-2.0.x/centos/\<span class="token variable">$releasever</span>
gpgcheck<span class="token operator">=</span>1
gpgkey<span class="token operator">=</span>https://repo.proxysql.com/ProxySQL/repo_pub_key
EOF
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p><strong>安装依赖：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># yum install -y mysql-libs perl-DBI perl-DBD-MySQL</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>开始安装：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># yum install -y proxysql-2.0.13-1</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>开放端口：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /sbin/iptables -I INPUT -p tcp --dport 6032 -j ACCEPT</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /etc/rc.d/init.d/iptables save</span>
iptables：将防火墙规则保存到 /etc/sysconfig/iptables：<span class="token punctuation">[</span>确定<span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /sbin/iptables -I INPUT -p tcp --dport 6033 -j ACCEPT</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /etc/rc.d/init.d/iptables save</span>
iptables：将防火墙规则保存到 /etc/sysconfig/iptables：<span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li></ul></pre> 
<p><strong>添加自启动：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># chkconfig --add proxysql</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># chkconfig proxysql on</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>删除文件：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rm -f /etc/proxysql.cnf</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>新增文件：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/proxysql.cnf</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">datadir<span class="token operator">=</span><span class="token string">"/var/lib/proxysql"</span>
errorlog<span class="token operator">=</span><span class="token string">"/var/lib/proxysql/proxysql.log"</span>
admin_variables<span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
        <span class="token comment">#本地登录的账号和密码</span>
        admin_credentials<span class="token operator">=</span><span class="token string">"admin:admin"</span>
        <span class="token comment">#本地登录的IP和端口号</span>
        mysql_ifaces<span class="token operator">=</span><span class="token string">"0.0.0.0:6032"</span>
<span class="token punctuation">}</span>
mysql_variables<span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
        threads<span class="token operator">=</span>4
        max_connections<span class="token operator">=</span>2048
        default_query_delay<span class="token operator">=</span>0
        default_query_timeout<span class="token operator">=</span>36000000
        have_compress<span class="token operator">=</span>true
        poll_timeout<span class="token operator">=</span>2000
        <span class="token comment">#远程登录的IP和端口号</span>
        interfaces<span class="token operator">=</span><span class="token string">"0.0.0.0:6033"</span>
        default_schema<span class="token operator">=</span><span class="token string">"information_schema"</span>
        stacksize<span class="token operator">=</span>1048576
        server_version<span class="token operator">=</span><span class="token string">"5.5.30"</span>
        connect_timeout_server<span class="token operator">=</span>3000
        <span class="token comment">#监控账号的账号和密码</span>
        monitor_username<span class="token operator">=</span><span class="token string">"monitor"</span>
        monitor_password<span class="token operator">=</span><span class="token string">"monitor"</span>
        monitor_history<span class="token operator">=</span>600000
        monitor_connect_interval<span class="token operator">=</span>60000
        monitor_ping_interval<span class="token operator">=</span>10000
        monitor_read_only_interval<span class="token operator">=</span>1500
        monitor_read_only_timeout<span class="token operator">=</span>500
        ping_interval_server_msec<span class="token operator">=</span>120000
        ping_timeout_server<span class="token operator">=</span>500
        commands_stats<span class="token operator">=</span>true
        sessions_sort<span class="token operator">=</span>true
        connect_retries_on_failure<span class="token operator">=</span>10
<span class="token punctuation">}</span>
<span class="token comment">#以下的配置我们会采用动态语句的形式配置</span>
mysql_servers <span class="token operator">=</span>
<span class="token punctuation">(</span>
<span class="token punctuation">)</span>
mysql_users:
<span class="token punctuation">(</span>
<span class="token punctuation">)</span>
mysql_query_rules:
<span class="token punctuation">(</span>
<span class="token punctuation">)</span>
scheduler<span class="token operator">=</span>
<span class="token punctuation">(</span>
<span class="token punctuation">)</span>
mysql_replication_hostgroups<span class="token operator">=</span>
<span class="token punctuation">(</span>
<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li><li style="color: rgb(153, 153, 153);">51</li><li style="color: rgb(153, 153, 153);">52</li><li style="color: rgb(153, 153, 153);">53</li></ul></pre> 
<blockquote> 
 <p>注意：6032是连接proxysq的管理端口，6033是对外提供服务的端口。</p> 
</blockquote> 
<p><strong>启动服务：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># service proxysql start</span>
Starting ProxySQL: 2020-08-25 20:30:00 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using config <span class="token function">file</span> /etc/proxysql.cnf
2020-08-25 20:30:00 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using OpenSSL version: OpenSSL 1.1.1d  10 Sep 2019
2020-08-25 20:30:00 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> No SSL keys/certificates found <span class="token keyword">in</span> datadir <span class="token punctuation">(</span>/var/lib/proxysql<span class="token punctuation">)</span>. Generating new keys/certificates.
DONE<span class="token operator">!</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li></ul></pre> 
<h3><a name="t89"></a><a name="t89"></a><a id="126_3585"></a>12.6、删除自带库</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rpm -qa | grep mysql</span>
mysql-libs-5.1.73-8.el6_8.x86_64
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rpm -e mysql-libs-5.1.73-8.el6_8.x86_64 --nodeps</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<h3><a name="t90"></a><a name="t90"></a><a id="127_3593"></a>12.7、安装依赖包</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># yum -y install numactl perl libaio wget</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t91"></a><a name="t91"></a><a id="128_3599"></a>12.8、下载服务端</h3> 
<p><strong>下载：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># wget https://cdn.mysql.com//Downloads/MySQL-5.6/MySQL-server-5.6.49-1.el6.x86_64.rpm</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>查看：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># ll MySQL-server-5.6.49-1.el6.x86_64.rpm</span>
-rw-r--r--. 1 root root 65467136 6月   3 13:36 MySQL-server-5.6.49-1.el6.x86_64.rpm
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t92"></a><a name="t92"></a><a id="129_3614"></a>12.9、安装服务端</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh MySQL-server-5.6.49-1.el6.x86_64.rpm</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t93"></a><a name="t93"></a><a id="1210_3620"></a>12.10、下载客户端</h3> 
<p><strong>下载：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># wget https://cdn.mysql.com//Downloads/MySQL-5.6/MySQL-client-5.6.49-1.el6.x86_64.rpm</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>查看：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># ll MySQL-client-5.6.49-1.el6.x86_64.rpm</span>
-rw-r--r--. 1 root root 21584380 6月   3 13:36 MySQL-client-5.6.49-1.el6.x86_64.rpm
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t94"></a><a name="t94"></a><a id="1211_3635"></a>12.11、安装客户端</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh MySQL-client-5.6.49-1.el6.x86_64.rpm</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<h3><a name="t95"></a><a name="t95"></a><a id="1212_3641"></a>12.12、启动数据库服务</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># service mysql start</span>
Starting MySQL.Logging to <span class="token string">'/var/lib/mysql/caochenlei.err'</span><span class="token keyword">.</span>
<span class="token punctuation">..</span>                                                         <span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<h3><a name="t96"></a><a name="t96"></a><a id="1213_3649"></a>12.13、查看初始化密码</h3> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># cat /root/.mysql_secret</span>
<span class="token comment"># The random password set for the root user at Tue Aug 25 20:31:19 2020 (local time): IFIn7pcTznYpoLm1</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t97"></a><a name="t97"></a><a id="1214_3656"></a>12.14、修改初始化密码</h3> 
<p><strong>登录：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -pIFIn7pcTznYpoLm1</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>修改：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">set</span> password <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<p><strong>退出：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">exit</span>
Bye
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t98"></a><a name="t98"></a><a id="1215_3678"></a>12.15、创建两个账号</h3> 
<p>这个操作是在master节点进行的，创建完成后，会自动复制到从节点，方便proxysql后来的监控和远程登录的认证连接</p> 
<blockquote> 
 <p>注意：可以使用 <code>select user,host from mysql.user;</code> 查看所有用户</p> 
</blockquote> 
<p><strong>为proxysql创建监控账号（主要做监控使用）：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'monitor'</span>@'<span class="token operator">%</span><span class="token string">' identified by '</span>monitor<span class="token string">';
grant all privileges on *.* to '</span>monitor<span class="token string">'@'</span><span class="token operator">%</span><span class="token string">' identified by '</span>monitor'<span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p><strong>为proxysql创建远程账号（主要是远程登录）：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'proxysql'</span>@'<span class="token operator">%</span><span class="token string">' identified by '</span>proxysql<span class="token string">';
grant all privileges on *.* to '</span>proxysql<span class="token string">'@'</span><span class="token operator">%</span><span class="token string">' identified by '</span>proxysql'<span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p><strong>退出：</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">mysql<span class="token operator">&gt;</span> <span class="token keyword">exit</span>
Bye
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t99"></a><a name="t99"></a><a id="1216proxysql_3707"></a>12.16、配置proxysql</h3> 
<p>这个操作是在安装proxysql的这台机器上的操作，6032端口的默认账号密码为admin，如果想要修改请在第12.5步修改，然后重启。</p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mysql -uadmin -padmin -h127.0.0.1 -P6032 --prompt 'admin&gt;'</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>分别执行以下语句</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment"># 配置主从复制的信息</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> mysql_servers<span class="token punctuation">(</span>hostgroup_id<span class="token punctuation">,</span>hostname<span class="token punctuation">,</span>port<span class="token punctuation">,</span>weight<span class="token punctuation">,</span>max_connections<span class="token punctuation">,</span>max_replication_lag<span class="token punctuation">,</span><span class="token keyword">comment</span><span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'192.168.206.128'</span><span class="token punctuation">,</span><span class="token number">3306</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'write mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> mysql_servers<span class="token punctuation">(</span>hostgroup_id<span class="token punctuation">,</span>hostname<span class="token punctuation">,</span>port<span class="token punctuation">,</span>weight<span class="token punctuation">,</span>max_connections<span class="token punctuation">,</span>max_replication_lag<span class="token punctuation">,</span><span class="token keyword">comment</span><span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'192.168.206.129'</span><span class="token punctuation">,</span><span class="token number">3306</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'read mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> mysql_servers<span class="token punctuation">(</span>hostgroup_id<span class="token punctuation">,</span>hostname<span class="token punctuation">,</span>port<span class="token punctuation">,</span>weight<span class="token punctuation">,</span>max_connections<span class="token punctuation">,</span>max_replication_lag<span class="token punctuation">,</span><span class="token keyword">comment</span><span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'192.168.206.130'</span><span class="token punctuation">,</span><span class="token number">3306</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'read mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 本地主机登录的账号：默认就是admin:admin不用再配置</span>

<span class="token comment"># 配置远程登录的账号：之前在master主节点中已经创建了</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> mysql_users<span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">,</span>active<span class="token punctuation">,</span>default_hostgroup<span class="token punctuation">,</span>transaction_persistent<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'proxysql'</span><span class="token punctuation">,</span><span class="token string">'proxysql'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 设置转发规则</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mysql_query_rules<span class="token punctuation">(</span>active<span class="token punctuation">,</span>match_pattern<span class="token punctuation">,</span>destination_hostgroup<span class="token punctuation">,</span><span class="token keyword">apply</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'^SELECT.*FOR UPDATE$'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mysql_query_rules<span class="token punctuation">(</span>active<span class="token punctuation">,</span>match_pattern<span class="token punctuation">,</span>destination_hostgroup<span class="token punctuation">,</span><span class="token keyword">apply</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'^SELECT'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 立刻加载配置</span>
<span class="token keyword">load</span> mysql servers <span class="token keyword">to</span> runtime<span class="token punctuation">;</span>
<span class="token keyword">load</span> mysql users <span class="token keyword">to</span> runtime<span class="token punctuation">;</span>
<span class="token keyword">load</span> mysql variables <span class="token keyword">to</span> runtime<span class="token punctuation">;</span>
<span class="token keyword">load</span> mysql query rules <span class="token keyword">to</span> runtime<span class="token punctuation">;</span>

<span class="token comment"># 配置写到磁盘</span>
<span class="token keyword">save</span> mysql servers <span class="token keyword">to</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>
<span class="token keyword">save</span> mysql users <span class="token keyword">to</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>
<span class="token keyword">save</span> mysql variables <span class="token keyword">to</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>
<span class="token keyword">save</span> mysql query rules <span class="token keyword">to</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li></ul></pre> 
<p>执行完成以后退出</p> 
<h3><a name="t100"></a><a name="t100"></a><a id="1217proxysql_3747"></a>12.17、连接proxysql</h3> 
<blockquote> 
 <p>注意：如果远程连接不上，请把防火墙全部关掉试试，如果不行，请重新启动一下proxysql，还是不行，请重头排查一下问题，或者查看日志<code>tail /var/lib/proxysql/proxysql.log</code>！</p> 
</blockquote> 
<p><strong>第一种：远程命令行连接测试</strong></p> 
<p>主节点、两个从节点随便找一台测试一下：</p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">##连接</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mysql -uproxysql -pproxysql -h192.168.206.131 -P6033</span>

<span class="token comment">##查看所有数据库</span>
mysql<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> mytest             <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">test</span>               <span class="token operator">|</span>
+--------------------+
5 rows <span class="token keyword">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span>0.05 sec<span class="token punctuation">)</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li></ul></pre> 
<p><strong>第二种：远程图形化窗口连接</strong></p> 
<p>注意这个端口是6033而不是3306，账号和密码我之前设置的都是proxysql</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUyMTIyMjgucG5n?x-oss-process=image/format,png" alt="image-20200825212223601"></p> 
<h3><a name="t101"></a><a name="t101"></a><a id="1218_3779"></a>12.18、查询监控数据</h3> 
<p>如果想要查看sql语句在哪个数据库执行的，在proxysql机器上请执行以下语句</p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mysql -uadmin -padmin -h127.0.0.1 -P6032 --prompt 'admin&gt;'</span>
admin<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from stats_mysql_query_digest<span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h2><a name="t102"></a><a name="t102"></a><a id="_MySQL_3788"></a>第十三章 安装MySQL分片集群</h2> 
<h3><a name="t103"></a><a name="t103"></a><a id="131_3790"></a>13.1、环境准备</h3> 
<p>我们使用之前的读写分离时候配置的一主两从这三台服务器，至于那个读写分离的数据库中间件proxysql服务器就用不着了，直接关机就行了，以下三台依次从主节点开始启动即可也就是CentOS 6 64 bit-1、CentOS 6 64 bit-2、CentOS 6 64 bit-3</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUyMTQxMDYucG5n?x-oss-process=image/format,png" alt="image-20200825111116521"></p> 
<h3><a name="t104"></a><a name="t104"></a><a id="132_3796"></a>13.2、分片集群介绍</h3> 
<p>如今随着互联网的发展，数据的量级也是撑指数的增长，从GB到TB到PB。对数据的各种操作也是愈加的困难，传统的关系性数据库已经无法满足快速查询与插入数据的需求。这个时候NoSQL的出现暂时解决了这一危机。它通过降低数据的安全性，减少对事务的支持，减少对复杂查询的支持，来获取性能上的提升。</p> 
<p>但是，在有些场合NoSQL一些折衷是无法满足使用场景的，就比如有些使用场景是绝对要有事务与安全指标的。这个时候NoSQL肯定是无法满足的，所以还是需要使用关系性数据库。如果使用关系型数据库解决海量存储的问题呢？此时就需要做数据库集群，为了提高查询性能将一个数据库的数据分散到不同的数据库中存储。简单来说，就是指通过某种特定的条件，将我们存放在同一个数据库中的数据分散存放到多个数据库（主机）上面，以达到分散单台设备负载的效果。而这其中，我们需要使用一个数据库中间件来完成，它就是Mycat。</p> 
<h3><a name="t105"></a><a name="t105"></a><a id="133_3802"></a>13.3、分片集群架构</h3> 
<p>实现目标：一主两从需要三组，再加上一个数据库中间件服务器，一共需要10台</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUyMjAxNDMucG5n?x-oss-process=image/format,png" alt="image-20200825220142607"></p> 
<p>如何演示：但实际上呢，这个分片集群是在主从复制模式上进行的演进，说白了，上边的3组一主两从，随便拿出来一个都是一个主从复制模式，那我们前一章已经完成了一主两从的学习，也就是已经配置好了这三台服务器，我们要是再拷贝出来两组就显得太麻烦了，学习嘛，怎么简单怎么来，现在我们手头只有一组，那我们就在这一组上进行演示，也就是一组上创建三个数据库，我们学习的架构就是下边这样了和上边的效果一模一样，如下图：</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjYwOTMxMzAucG5n?x-oss-process=image/format,png" alt="image-20200826093129272"></p> 
<h3><a name="t106"></a><a name="t106"></a><a id="134Mycat_3811"></a>13.4、Mycat的介绍</h3> 
<p>Mycat 背后是阿里曾经开源的知名产品——Cobar。Cobar 的核心功能和优势是 MySQL 数据库分片，此产品曾经广为流传，据说最早的发起者对 MySQL 很精通，后来从阿里跳槽了，阿里随后开源的 Cobar，并维持到 2013 年年初，然后，就没有然后了。</p> 
<p>Cobar 的思路和实现路径的确不错。基于 Java 开发的，实现了 MySQL 公开的二进制传输协议，巧妙地将自己伪装成一个 MySQL Server，目前市面上绝大多数 MySQL 客户端工具和应用都能兼容。比自己实现一个新的数据库协议要明智的多，因为生态环境在哪里摆着。</p> 
<p>Mycat 是基于 cobar 演变而来，对 cobar 的代码进行了彻底的重构，使用 NIO 重构了网络模块，并且优化了 Buffer 内核，增强了聚合，Join 等基本特性，同时兼容绝大多数数据库成为通用的数据库中间件。</p> 
<p>简单的说，MyCAT就是一个新颖的数据库中间件产品，支持mysql集群或者mariadb集群，提供高可用性数据分片集群。你可以像使用mysql一样使用mycat。对于开发人员来说根本感觉不到mycat的存在。</p> 
<p>它支持的数据库产品非常的多如：</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUyMTUwNDYucG5n?x-oss-process=image/format,png" alt="image-20200825215043387"></p> 
<h3><a name="t107"></a><a name="t107"></a><a id="135Mycat_3825"></a>13.5、Mycat的分片</h3> 
<p>分片就是指通过某种特定的条件，将我们存放在同一个数据库中的数据分散存放到多个数据库（主机）上面，以达到分散单台设备负载的效果。</p> 
<p>数据的切分（Sharding）根据其切分规则的类型，可以分为两种切分模式。</p> 
<p>（1）一种是按照不同的表（或者Schema）来切分到不同的数据库（主机）之上，这种切分可以称之为数据的垂直（纵向）切分</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUyMTUyMDQuanBn?x-oss-process=image/format,png" alt="img"></p> 
<p>（2）另外一种则是根据表中的数据的逻辑关系，将同一个表中的数据按照某种条件拆分到多台数据库（主机）上面，这种切分称之为数据的水平（横向）切分。</p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUyMTUzNTIucG5n?x-oss-process=image/format,png" alt="image-20200825215350981"></p> 
<h3><a name="t108"></a><a name="t108"></a><a id="136Mycat_3839"></a>13.6、Mycat的安装</h3> 
<p>官方网址：<a href="http://www.mycat.org.cn/">Mycat</a></p> 
<p>默认端口：<strong>8066</strong></p> 
<p>JDK：要求jdk必须是1.7及以上版本</p> 
<p>MySQL：推荐mysql是5.5及以上版本</p> 
<p><strong>安装JDK8：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#查看软件</span>
rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> java
rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> jdk

<span class="token comment">#批量卸载</span>
rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> jdk <span class="token operator">|</span> <span class="token function">xargs</span> rpm -e --nodeps
rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> java <span class="token operator">|</span> <span class="token function">xargs</span> rpm -e --nodeps

<span class="token comment">#在线安装</span>
yum <span class="token function">install</span> -y java-1.8.0-openjdk java-1.8.0-openjdk-devel

<span class="token comment">#通过yum方式安装默认安装在/usr/lib/jvm文件下，看看你自己安装的具体是哪个版本</span>
ll /usr/lib/jvm/

<span class="token comment">#编辑/etc/profile文件，在文件最后写入环境变量，然后保存退出</span>
<span class="token function">vi</span> /etc/profile

<span class="token comment"># java environment</span>
<span class="token function">export</span> JAVA_HOME<span class="token operator">=</span>/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el6_10.x86_64
<span class="token function">export</span> JRE_HOME<span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/jre
<span class="token function">export</span> CLASSPATH<span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/jre/lib/tools.jar:<span class="token variable">$JRE_HOME</span>/lib:<span class="token variable">$CLASSPATH</span>
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$PATH</span>

<span class="token comment">#使环境变量生效</span>
<span class="token function">source</span> /etc/profile

<span class="token comment">#查看安装是否成功，这两个都能出来就安装成功了</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># java -version</span>
openjdk version <span class="token string">"1.8.0_262"</span>
OpenJDK Runtime Environment <span class="token punctuation">(</span>build 1.8.0_262-b10<span class="token punctuation">)</span>
OpenJDK 64-Bit Server VM <span class="token punctuation">(</span>build 25.262-b10, mixed mode<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># javac -version</span>
javac 1.8.0_262
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li></ul></pre> 
<p><strong>下载：</strong></p> 
<blockquote> 
 <p>注意：失效的话，请自行百度，然后上传到虚拟机</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># wget http://dl.mycat.org.cn/1.6-RELEASE/Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>解压：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># tar -zxvf Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>安装：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># mv mycat /usr/local</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>添加防火墙：</strong></p> 
<blockquote> 
 <p>注意：mycat数据端口默认为8066，管理端口默认为9066，我们都需要对外开放</p> 
</blockquote> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /sbin/iptables -I INPUT -p tcp --dport 8066 -j ACCEPT</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /sbin/iptables -I INPUT -p tcp --dport 9066 -j ACCEPT</span>
<span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /etc/rc.d/init.d/iptables save</span>
iptables：将防火墙规则保存到 /etc/sysconfig/iptables：<span class="token punctuation">[</span>确定<span class="token punctuation">]</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li></ul></pre> 
<p><strong>添加域名解析：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/hosts</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

<span class="token comment">#配置当前主机名称的域名解析</span>
192.168.206.128 caochenlei

<span class="token comment">#配置一主两从服务的域名解析</span>
192.168.206.128 master1
192.168.206.129 slave1
192.168.206.130 slave2
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li></ul></pre> 
<p><strong>常用命令：</strong></p> 
<ul><li>/usr/local/mycat/bin/mycat start 启动</li><li>/usr/local/mycat/bin/mycat stop 停止</li><li>/usr/local/mycat/bin/mycat console 前台运行，可以显示日志，新手建议使用</li><li>/usr/local/mycat/bin/mycat restart 重启服务</li><li>/usr/local/mycat/bin/mycat pause 暂停</li><li>/usr/local/mycat/bin/mycat status 查看启动状态</li></ul> 
<h3><a name="t109"></a><a name="t109"></a><a id="137Mycat_3946"></a>13.7、Mycat的配置</h3> 
<p>第一步：登录主节点创建三个数据库分别是db1、db2、db3</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">`</span>db1<span class="token punctuation">`</span><span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8<span class="token punctuation">;</span> 
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">`</span>db2<span class="token punctuation">`</span><span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8<span class="token punctuation">;</span> 
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">`</span>db3<span class="token punctuation">`</span><span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8<span class="token punctuation">;</span> 
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<p>第二步：修改<strong>schema.xml</strong>文件</p> 
<p><strong>删除原有配置</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rm -f /usr/local/mycat/conf/schema.xml</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>新增我们配置</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/local/mycat/conf/schema.xml</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token prolog">&lt;?xml version="1.0"?&gt;</span>
<span class="token doctype">&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mycat:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>mycat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://io.mycat/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>STOREDB<span class="token punctuation">"</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- rule采用按主键范围分片，主键名为id（默认） --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>TB_USERS<span class="token punctuation">"</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dn1,dn2,dn3<span class="token punctuation">"</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>auto-sharding-long<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token comment">&lt;!-- rule采用按哈希一致分片，主键名为order_id（自己修改） --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>TB_ORDER<span class="token punctuation">"</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dn1,dn2,dn3<span class="token punctuation">"</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sharding-by-murmur-order<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dn1<span class="token punctuation">"</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>OneMasterAndTwoSlave<span class="token punctuation">"</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>db1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dn2<span class="token punctuation">"</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>OneMasterAndTwoSlave<span class="token punctuation">"</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>db2<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dn3<span class="token punctuation">"</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>OneMasterAndTwoSlave<span class="token punctuation">"</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>db3<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>OneMasterAndTwoSlave<span class="token punctuation">"</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mysql<span class="token punctuation">"</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>native<span class="token punctuation">"</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 心跳语句 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 一主两从 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hostM1<span class="token punctuation">"</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>master1:3306<span class="token punctuation">"</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hostS1<span class="token punctuation">"</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slave1:3306<span class="token punctuation">"</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hostS2<span class="token punctuation">"</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slave2:3306<span class="token punctuation">"</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123456<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mycat:</span>schema</span><span class="token punctuation">&gt;</span></span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li></ul></pre> 
<p>第三步：修改<strong>server.xml</strong>文件</p> 
<p>server.xml几乎保存了所有mycat需要的系统配置信息，最常用的是在此配置用户名、密码及权限。</p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/local/mycat/conf/server.xml</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>在system中添加UTF-8字符集设置，否则存储中文会出现问号。</p> 
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>charset<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>utf8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>修改user的设置 , 我们这里为STOREDB数据库设置了两个用户。把它之前的两个用户删掉，把咱们自己设置的放进去。</p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token operator">&lt;</span>user name<span class="token operator">=</span><span class="token string">"test"</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">&gt;</span>test<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"schemas"</span><span class="token operator">&gt;</span>STOREDB<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/user<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>user name<span class="token operator">=</span><span class="token string">"root"</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">&gt;</span>root<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"schemas"</span><span class="token operator">&gt;</span>STOREDB<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/user<span class="token operator">&gt;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li></ul></pre> 
<p>第四步：修改<strong>auto-sharding-rang-mod.txt</strong>文件</p> 
<p>修改主键范围分片大小</p> 
<p><strong>删除：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># rm -f /usr/local/mycat/conf/auto-sharding-rang-mod.txt</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p><strong>新增：</strong></p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/local/mycat/conf/auto-sharding-rang-mod.txt</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<pre class="prettyprint"><code class="prism language-properties has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">0-500M=0
500M1-1000M=1
1000M1-1500M=2
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> 
<blockquote> 
 <p>注意：以上意思是主键id在0-500M的数据放在分片1中，500M1-1000M的数据放到分片2中，1000M1-1500M的数据放到分片3中，超过1500M1，就报错</p> 
</blockquote> 
<p>第五步：修改<strong>rule.xml</strong>文件</p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># vi /usr/local/mycat/conf/rule.xml</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre> 
<p>新增哈希订单主键，因为默认主键名都是id，要想是自己定义的，就拷贝一份，重新起个名，然后修改columns成你数据表的那个主键名称就行了</p> 
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sharding-by-murmur-order<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>order_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>murmur<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>修改分片数量，因为现在有db1、db2、db3个分片，找到<code>&lt;function name="murmur"</code>中的count，修改为<mark>3</mark>，如以下所示：</p> 
<pre class="prettyprint"><code class="prism language-xml has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>murmur<span class="token punctuation">"</span></span>
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>io.mycat.route.function.PartitionByMurmurHash<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>seed<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 默认是0 --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>count<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 要分片的数据库节点数量，必须指定，否则没法分片 --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>virtualBucketTimes<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>160<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 一个实际的数据库节点被映射为这么多虚拟节点，默认是160倍，也就是虚拟节点数是物理节点数的160倍 --&gt;</span>
                <span class="token comment">&lt;!-- &lt;property name="weightMapFile"&gt;weightMapFile&lt;/property&gt; 节点的权重，没有指定权重的节点默认是1。以properties文件的格式填写，以从0开始到count-1的整数值&gt;也就是节点索引为key，以节点权重值为值。所有权重值必须是正整数，否则以1代替 --&gt;</span>
                <span class="token comment">&lt;!-- &lt;property name="bucketMapPath"&gt;/etc/mycat/bucketMapPath&lt;/property&gt;
                        用于测试时观察各物理节点与虚拟节点的分布情况，如果指定了这个属性，会把虚拟节点的murmur hash值与物理节点的映射按行输出到这个文件，没有默认值，如果不
指定，就不会输出任何东西 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li></ul></pre> 
<h3><a name="t110"></a><a name="t110"></a><a id="138Mycat_4080"></a>13.8、Mycat的启动</h3> 
<p>在启动之前，我们需要做一个密码重置的工作，也不知道这是不是个BUG，但是，你要不做密码重置，很可能Mycat它启动不起来，我也是醉了，就这一个问题，搞了我一晚上的心态，操作步骤如下：</p> 
<p>依次在主节点、从节点一、从节点二执行以下四条语句：</p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">use</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> password <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> password <span class="token keyword">for</span> <span class="token string">'root'</span> <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#如果上句报错使用下边这个，不报错就算了</span>
<span class="token keyword">set</span> password <span class="token operator">=</span> password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li></ul></pre> 
<p>然后再启动Mycat</p> 
<pre class="prettyprint"><code class="prism language-shell has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token punctuation">[</span>root@caochenlei ~<span class="token punctuation">]</span><span class="token comment"># /usr/local/mycat/bin/mycat start</span>
Starting Mycat-server<span class="token punctuation">..</span>.
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> 
<h3><a name="t111"></a><a name="t111"></a><a id="139Mycat_4102"></a>13.9、Mycat的测试</h3> 
<blockquote> 
 <p>注意：在这里我使用图形化界面来操作，先测试是否连通，如果不能连上，请检查虚拟机防火墙是否关闭，那两个用户是否配对，如果Mycat重启不成功，请使用<code>ps -ef | grep mycat</code>查看，然后使用kill强制杀死，再然后重新启动，如果不知道什么问题，请使用前台运行，它会显示出错误信息，然后再解决</p> 
</blockquote> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjUyMzUzNDAucG5n?x-oss-process=image/format,png" alt="image-20200825235336310"></p> 
<p><strong>创建用户表，然后插入数据，直接拷贝以下SQL代码到窗口，然后运行，必须一步一步来并且不要进行窗口操作对连接Mycat的那个连接，因为会报错</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#第一步：删表</span>
<span class="token keyword">USE</span> <span class="token punctuation">`</span>STOREDB<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">#第二步：建表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">#第三步：插入数据</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'zhangsan1'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'zhangsan2'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'zhangsan3'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">5000001</span><span class="token punctuation">,</span><span class="token string">'lisi1'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">5000002</span><span class="token punctuation">,</span><span class="token string">'lisi2'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">5000003</span><span class="token punctuation">,</span><span class="token string">'lisi3'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">10000001</span><span class="token punctuation">,</span><span class="token string">'wangwu1'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">10000002</span><span class="token punctuation">,</span><span class="token string">'wangwu2'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_USERS<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">10000003</span><span class="token punctuation">,</span><span class="token string">'wangwu3'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li></ul></pre> 
<p><strong>创建订单表，然后插入数据，直接拷贝以下SQL代码到窗口，然后运行，必须一步一步来并且不要进行窗口操作对连接Mycat的那个连接，因为会报错</strong></p> 
<pre class="prettyprint"><code class="prism language-sql has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token comment">#第一步：删表</span>
<span class="token keyword">USE</span> <span class="token punctuation">`</span>STOREDB<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">#第二步：建表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>order_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">#第三步：插入数据</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'201708261157265358046058'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 11:57:26'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:48:22'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'201708261221397410698125'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:21:39'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:48:22'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'201708261234474784646997'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:34:47'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:48:22'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'201708261247443132289031'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:47:44'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:48:22'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'918773291320152064534354'</span><span class="token punctuation">,</span><span class="token string">'2017-10-13 17:39:57'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:48:22'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'918780410236788736453543'</span><span class="token punctuation">,</span><span class="token string">'2017-10-13 18:08:14'</span><span class="token punctuation">,</span><span class="token string">'2017-10-13 18:09:36'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'918806410983137280453453'</span><span class="token punctuation">,</span><span class="token string">'2017-10-13 19:51:33'</span><span class="token punctuation">,</span><span class="token string">'2017-10-13 19:51:47'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'918833486129815552274522'</span><span class="token punctuation">,</span><span class="token string">'2017-10-13 21:39:08'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:48:22'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'918835712999055360745325'</span><span class="token punctuation">,</span><span class="token string">'2017-10-13 21:47:59'</span><span class="token punctuation">,</span><span class="token string">'2017-10-13 21:49:28'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'919055625042825216545334'</span><span class="token punctuation">,</span><span class="token string">'2017-10-14 12:21:50'</span><span class="token punctuation">,</span><span class="token string">'2017-08-26 12:48:22'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span>  <span class="token keyword">into</span> <span class="token punctuation">`</span>TB_ORDER<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pay_time<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>total_fee<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'919059761058607104453433'</span><span class="token punctuation">,</span><span class="token string">'2017-10-14 12:38:16'</span><span class="token punctuation">,</span><span class="token string">'2017-10-14 12:38:24'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'lijialong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li></ul></pre> 
<h3><a name="t112"></a><a name="t112"></a><a id="1310Mycat_4166"></a>13.10、Mycat的效果</h3> 
<p>重开一个窗口，连接主节点，依次查看，db1、db2、db3上的TB_USERS、TB_ORDER，你会发现数据是均匀分布的，这就实现了我们最终的分片集群了，具体效果图如下：</p> 
<p><strong>db1&gt;TB_USERS</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjYwMjAxMjAucG5n?x-oss-process=image/format,png" alt="image-20200826020118355"></p> 
<p><strong>db2&gt;TB_USERS</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjYwMjAxNDAucG5n?x-oss-process=image/format,png" alt="image-20200826020137393"></p> 
<p><strong>db3&gt;TB_USERS</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjYwMjAyMDMucG5n?x-oss-process=image/format,png" alt="image-20200826020201015"></p> 
<p><strong>db1&gt;TB_ORDER</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjYwMjAyMjkucG5n?x-oss-process=image/format,png" alt="image-20200826020226630"></p> 
<p><strong>db2&gt;TB_ORDER</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjYwMjAyNDcucG5n?x-oss-process=image/format,png" alt="image-20200826020245571"></p> 
<p><strong>db3&gt;TB_ORDER</strong></p> 
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vY2FvY2hlbmxlaS9CbG9nSW1hZ2VzL3Jhdy9tYXN0ZXIvMjAyMDA4MjYwMjAyNTkucG5n?x-oss-process=image/format,png" alt="image-20200826020257914"></p> 
<h3><a name="t113"></a><a name="t113"></a><a id="1311Mycat_4194"></a>13.11、Mycat的踩坑</h3> 
<ol><li>Mycat只是一个数据库中间件，它并不是一个真正的数据库，所以用窗口不能直接操作，需要使用SQL语句</li><li>Mycat依赖于JDK1.7+，我建议使用JDK1.8</li><li>Mycat只是帮你做了数据分片，真正的主从复制还是靠你自己实现</li><li>当你创建表的时候，Mycat默认会把表名转换为大写，所以你创建的时候就直接把表名大写和数据库名大写，否则可能会找不到表，因为大小写不对应</li><li>当你的主键字段不是id的时候，直接在ruls.xml中拷贝一份相对应类型的tableRule，然后改个规则名称和字段名称就行了，然后再引用自定义的那个</li></ol>
                </div><div><div></div></div>
                <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-d7a94ec6ab.css" rel="stylesheet">
                <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-ba784fbaf8.css" rel="stylesheet">
        </div>